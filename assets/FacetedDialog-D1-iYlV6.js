import{a as _,R as e,aw as T,d as L,bi as z,aa as M,bj as B,c as R,m as N,o as W,ax as V,T as A,bk as K,u as x,$ as O,bl as j,bm as P,bn as I,bo as H,bg as U,bp as q,am as J,al as Q,bh as X,D as Y}from"./index-DvmOrY9r.js";import{d as D}from"./Clear-vP6lRNzs.js";import{S as Z,T as ee}from"./HierarchicalTrackSelector-DEqEEyth.js";function te({model:r}){const{faceted:a}=r,[h,s]=_.useState(null),{showOptions:d,showFilters:w,showSparse:m,useShoppingCart:u}=a;return e.createElement(e.Fragment,null,e.createElement(T,{container:!0,spacing:4,alignItems:"center"},e.createElement(T,{item:!0},e.createElement(L,{label:"Search...",value:a.filterText,onChange:i=>{a.setFilterText(i.target.value)},InputProps:{endAdornment:e.createElement(z,{position:"end"},e.createElement(M,{onClick:()=>{a.setFilterText("")}},e.createElement(D,null)))}})),e.createElement(T,{item:!0},e.createElement(M,{onClick:i=>{s(i.currentTarget)}},e.createElement(B,null))),e.createElement(T,{item:!0},e.createElement(Z,{model:r}))),e.createElement(R.Menu,{anchorEl:h,open:!!h,onClose:()=>{s(null)},onMenuItemClick:(i,c)=>{c(),s(null)},menuItems:[{label:"Add tracks to selection instead of turning them on/off",onClick:()=>{a.setUseShoppingCart(!u)},type:"checkbox",checked:u},{label:"Show sparse metadata columns",onClick:()=>{a.setShowSparse(!m)},checked:m,type:"checkbox"},{label:"Show facet filters",onClick:()=>{a.setShowFilters(!w)},checked:w,type:"checkbox"},{label:"Show extra table options",onClick:()=>{a.setShowOptions(!d)},checked:d,type:"checkbox"}]}))}const ae=N()(r=>({facet:{margin:0,marginLeft:r.spacing(2)},select:{marginBottom:r.spacing(2)}}));function ne({onClick:r}){return e.createElement(O,{title:"Clear selection on this facet filter"},e.createElement(M,{onClick:()=>{r()},size:"small"},e.createElement(D,null)))}function le({visible:r,onClick:a}){return e.createElement(O,{title:"Minimize/expand this facet filter"},e.createElement(M,{onClick:()=>{a()},size:"small"},r?e.createElement(j,null):e.createElement(P,null)))}const re=W(function({column:r,vals:a,model:h}){const{classes:s}=ae(),[d,w]=_.useState(!0),{faceted:m}=h,{filters:u}=m,{field:i}=r;return e.createElement(V,{className:s.facet,fullWidth:!0},e.createElement("div",null,e.createElement(A,{component:"span"},i),e.createElement(ne,{onClick:()=>{m.setFilter(i,[])}}),e.createElement(le,{visible:d,onClick:()=>{w(!d)}})),d?e.createElement(K,{multiple:!0,native:!0,className:s.select,value:u.get(r.field)||[],onChange:c=>{m.setFilter(r.field,[...c.target.options].filter(f=>f.selected).map(f=>f.value))}},a.sort((c,f)=>c[0].localeCompare(f[0])).map(([c,f])=>e.createElement("option",{key:c,value:c},x.coarseStripHTML(c)," (",f,")"))):null)}),oe=W(function({rows:r,columns:a,model:h}){var s,d;const{faceted:w}=h,{filters:m}=w,u=a.slice(1),i=new Map(u.map(l=>[l.field,new Map])),c=w.filters.keys(),f=u.map(l=>l.field),b=new Set;for(const l of c)!((s=m.get(l))===null||s===void 0)&&s.length&&b.add(l);for(const l of f)b.add(l);let S=r;for(const l of b){const E=i.get(l);for(const g of S){const k=I(l,g),v=E.get(k);k&&(v===void 0?E.set(k,1):E.set(k,v+1))}const C=!((d=m.get(l))===null||d===void 0)&&d.length?new Set(m.get(l)):void 0;S=S.filter(g=>C!==void 0?C.has(I(l,g)):!0)}return e.createElement("div",null,u.map(l=>e.createElement(re,{key:l.field,vals:[...i.get(l.field)],column:l,model:h})))}),se=N()({cell:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},resizeHandle:{marginLeft:5,background:"grey",width:5}}),F=.75,ie=W(function({model:a}){var h;const{classes:s}=se(),{view:d,selection:w,shownTrackIds:m,faceted:u}=a,{rows:i,panelWidth:c,showFilters:f,useShoppingCart:b,showOptions:S,filteredRows:l,filteredNonMetadataKeys:E,filteredMetadataKeys:C,visible:g}=u,{pluginManager:k}=x.getEnv(a),[v,G]=_.useState({name:x.measureGridWidth(i.map(t=>t.name),{maxWidth:500,stripHTML:!0})+15,...Object.fromEntries(E.filter(t=>g[t]).map(t=>[t,x.measureGridWidth(i.map(o=>o[t]),{maxWidth:400,stripHTML:!0})])),...Object.fromEntries(C.filter(t=>g[`metadata.${t}`]).map(t=>[`metadata.${t}`,x.measureGridWidth(i.map(o=>o.metadata[t]),{maxWidth:400,stripHTML:!0})]))}),$=[{field:"name",hideable:!1,renderCell:t=>{const{value:o,row:p}=t,{id:n,conf:y}=p;return e.createElement("div",{className:s.cell},e.createElement(H,{html:o}),e.createElement(ee,{id:n,conf:y,trackId:n,model:a}))},width:(h=v.name)!==null&&h!==void 0?h:100},...E.map(t=>{var o;return{field:t,width:(o=v[t])!==null&&o!==void 0?o:100,renderCell:p=>{const n=p.value;return n?e.createElement(H,{className:s.cell,html:n}):""}}}),...C.map(t=>{var o;return{field:`metadata.${t}`,headerName:["name",...E].includes(t)?`${t} (from metadata)`:t,width:(o=v[`metadata.${t}`])!==null&&o!==void 0?o:100,valueGetter:(p,n)=>{var y;return`${(y=n.metadata[t])!==null&&y!==void 0?y:""}`},renderCell:p=>{const n=p.value;return n?e.createElement(H,{className:s.cell,html:n}):""}}})];return e.createElement(e.Fragment,null,e.createElement(te,{model:a}),e.createElement("div",{style:{display:"flex",overflow:"hidden",height:window.innerHeight*F,width:window.innerWidth*F}},e.createElement("div",{style:{height:window.innerHeight*F,width:window.innerWidth*F-(f?c:0)}},e.createElement(U,{rows:l,onColumnWidthChange:t=>{G({...v,[t.colDef.field]:t.width})},columnVisibilityModel:g,onColumnVisibilityModelChange:t=>{u.setVisible(t)},columnHeaderHeight:35,checkboxSelection:!0,disableRowSelectionOnClick:!0,keepNonExistentRowsSelected:!0,onRowSelectionModelChange:t=>{if(b){const o=J(a),p=k.pluggableConfigSchemaType("track");a.setSelection(t.map(n=>Q(p,o,n)))}else{const o=m,p=new Set(t);q(()=>{[...o].filter(n=>!p.has(n)).map(n=>d.hideTrack(n)),[...p].filter(n=>!o.has(n)).map(n=>{d.showTrack(n),a.addToRecentlyUsed(n)})})}},rowSelectionModel:b?w.map(t=>t.trackId):[...m],slots:{toolbar:S?X:null},slotProps:{toolbar:{printOptions:{disableToolbarButton:!0}}},columns:$,rowHeight:25})),f?e.createElement(e.Fragment,null,e.createElement(R.ResizeHandle,{vertical:!0,onDrag:t=>u.setPanelWidth(c-t),className:s.resizeHandle}),e.createElement("div",{style:{width:c,overflow:"auto"}},e.createElement(oe,{model:a,rows:i,columns:$}))):null))}),ue=W(function(r){const{handleClose:a}=r;return e.createElement(R.Dialog,{open:!0,onClose:a,maxWidth:"xl",title:"Faceted track selector"},e.createElement(Y,null,e.createElement(ie,{...r})))});export{ue as default};
//# sourceMappingURL=FacetedDialog-D1-iYlV6.js.map
