import{I as m,a3 as M,Q as y,u as w,a1 as T,O as x}from"./index-Do-r7xR6.js";import{I as C}from"./main-BPWpXae6.js";import{V as I}from"./index-DtxB5Aq8.js";class L extends m.BaseFeatureDataAdapter{constructor(){super(...arguments),this.calculatedIntervalTreeMap={}}async getHeader(){const{header:e}=await this.setup();return e}async getMetadata(){const{header:e}=await this.setup();return new M({header:e}).getMetadata()}async setupP(e){const{statusCallback:r=()=>{}}=e||{},i=await y.openLocation(this.getConf("vcfLocation"),this.pluginManager).readFile(e),a=w.isGzip(i)?await w.updateStatus("Unzipping",r,()=>T(i)):i,c=[],o={};let n=0;const l=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;let p=0;for(;n<a.length;){const s=a.indexOf(`
`,n),d=s===-1?a.subarray(n):a.subarray(n,s),t=((l==null?void 0:l.decode(d))||d.toString()).trim();if(t)if(t.startsWith("#"))c.push(t);else{const f=t.indexOf("	"),u=t.slice(0,f);o[u]||(o[u]=[]),o[u].push(t)}p++%1e4===0&&r(`Loading ${Math.floor(n/1e6).toLocaleString("en-US")}/${Math.floor(a.length/1e6).toLocaleString("en-US")} MB`),n=s+1}const g=c.join(`
`),v=new M({header:g}),b=Object.fromEntries(Object.entries(o).map(([s,d])=>[s,t=>{if(!this.calculatedIntervalTreeMap[s]){t==null||t("Parsing VCF data");let f=0;const u=new C;for(const F of d){const h=new I({variant:v.parseLine(F),parser:v,id:`${this.id}-${s}-${f++}`});u.insert([h.get("start"),h.get("end")],h)}this.calculatedIntervalTreeMap[s]=u}return this.calculatedIntervalTreeMap[s]}]));return{header:g,intervalTreeMap:b}}async setup(){return this.vcfFeatures||(this.vcfFeatures=this.setupP().catch(e=>{throw this.vcfFeatures=void 0,e})),this.vcfFeatures}async getRefNames(e={}){const{intervalTreeMap:r}=await this.setup();return Object.keys(r)}getFeatures(e,r={}){return x(async i=>{var a;try{const{start:c,end:o,refName:n}=e,{intervalTreeMap:l}=await this.setup();(a=l[n])===null||a===void 0||a.call(l,r.statusCallback).search([c,o]).forEach(p=>{i.next(p)}),i.complete()}catch(c){i.error(c)}},r.signal)}freeResources(){}}L.capabilities=["getFeatures","getRefNames"];export{L as default};
//# sourceMappingURL=VcfAdapter-BNmlcbRY.js.map
