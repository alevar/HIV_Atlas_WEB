import{e as $,u as A,X as I,Z as L,$ as V,a_ as U,a$ as B}from"./rpcWorker-CL9qhe4-.js";import{h as F}from"./util-C5_pe8_J.js";function T(t,a,n,o,r,c){n<0&&(t+=n,n=-n),o<0&&(a+=o,o=-o),c&&(r.fillStyle=c),r.fillRect(t,a,n,o)}function X(t,a,n,o,r,c){n<0&&(t+=n,n=-n),o<0&&(a+=o,o=-o),c&&(r.strokeStyle=c),r.strokeRect(t,a,n,o)}function Z({ctx:t,self:a,chainData:n,view:o,asm:r}){var c,u,N,C,S,M,R;const p=[],x=$.getConf(a,"featureHeight"),k=((c=a.colorBy)===null||c===void 0?void 0:c.type)||"insertSizeAndOrientation",{chains:y,stats:H}=n;for(const s of y)if(s.length>1){const e=s[0],f=s[1],i=r.getCanonicalRefName(e.refName)||e.refName,d=r.getCanonicalRefName(f.refName)||f.refName,l=(u=o.bpToPx({refName:i,coord:e.start}))===null||u===void 0?void 0:u.offsetPx,m=(N=o.bpToPx({refName:i,coord:e.end}))===null||N===void 0?void 0:N.offsetPx,b=(C=o.bpToPx({refName:d,coord:f.start}))===null||C===void 0?void 0:C.offsetPx,h=(S=o.bpToPx({refName:d,coord:f.end}))===null||S===void 0?void 0:S.offsetPx;let _=0;if(l!==void 0&&m!==void 0&&b!==void 0&&h!==void 0){if(e.refName===f.refName){const v=Math.min(e.start,f.start),P=Math.max(e.end,f.end);_=Math.abs(P-v)}p.push({r1s:l,r1e:m,r2s:b,r2e:h,v0:e,v1:f,distance:_})}}else if(a.drawSingletons){const e=s[0],f=r.getCanonicalRefName(e.refName)||e.refName,i=(M=o.bpToPx({refName:f,coord:e.start}))===null||M===void 0?void 0:M.offsetPx,d=(R=o.bpToPx({refName:f,coord:e.end}))===null||R===void 0?void 0:R.offsetPx;if(i!==void 0&&d!==void 0){const l=Math.max(d-i,2);T(i-o.offsetPx,0,l,x,t,"#f00"),X(i-o.offsetPx,0,l,x,t,"#a00")}}const E=Math.log(A.max(p.map(s=>s.distance))),z=Math.max(Math.log(A.min(p.map(s=>s.distance)))-1,0),g=(a.height-20)/(E-z);for(const{r1e:s,r1s:e,r2e:f,r2s:i,distance:d,v0:l,v1:m}of p){const b=Math.max(s-e,2),h=Math.max(f-i,2),[_,v]=j({type:k,v0:l,v1:m,stats:H})||[],P=(Math.log(d)-z)*g,O=x/2-.5,D=i-s;T(s-o.offsetPx,P+O,D,1,t,"black"),X(e-o.offsetPx,P,b,x,t,v),X(i-o.offsetPx,P,h,x,t,v),T(e-o.offsetPx,P,b,x,t,_),T(i-o.offsetPx,P,h,x,t,_)}}function j({type:t,v0:a,v1:n,stats:o}){if(t==="insertSizeAndOrientation")return I(a,n,o);if(t==="orientation")return L(a);if(t==="insertSize")return V(a,n,o);if(t==="gradient"){const r=Math.min(a.start,n.start),c=Math.max(a.end,n.end);return[`hsl(${Math.log10(Math.abs(c-r))*10},50%,50%)`,`hsl(${Math.log10(Math.abs(c-r))*10},50%,30%)`]}}function q({ctx:t,self:a,chainData:n,view:o,asm:r}){var c,u,N,C,S;const M=[],R=[],{chains:p}=n,{height:x}=a,k=$.getConf(a,"featureHeight");for(const g of p){let s=Number.MAX_VALUE,e=Number.MIN_VALUE;for(const i of g){const d=r.getCanonicalRefName(i.refName)||i.refName,l=(c=o.bpToPx({refName:d,coord:i.start}))===null||c===void 0?void 0:c.offsetPx,m=(u=o.bpToPx({refName:d,coord:i.end}))===null||u===void 0?void 0:u.offsetPx;l!==void 0&&m!==void 0&&(s=Math.min(s,l),e=Math.max(e,m))}const f=Math.abs(e-s);M.push(f),R.push(s)}const y=Math.log(A.max(M)),H=Math.max(Math.log(A.min(M))-1,0),E=(x-20)/(y-H),z=k/2-.5;for(let g=0;g<p.length;g++){const s=p[g],e=M[g],f=(Math.log(e)-H)*E,i=R[g];T(i-o.offsetPx,f+z,e,1,t,"black");const d=s[0];let l;d.flags&2048?l=((N=d.SA)===null||N===void 0?void 0:N.split(";")[0].split(",")[2])==="-"?-1:1:l=d.strand;for(const m of s){const b=r.getCanonicalRefName(m.refName)||m.refName,h=(C=o.bpToPx({refName:b,coord:m.start}))===null||C===void 0?void 0:C.offsetPx,_=(S=o.bpToPx({refName:b,coord:m.end}))===null||S===void 0?void 0:S.offsetPx;if(h!==void 0&&_!==void 0){const v=Math.max(_-h,2),P=h-o.offsetPx,D=m.strand*l===-1?"color_rev_strand":"color_fwd_strand";X(P,f,v,k,t,U[D]),T(P,f,v,k,t,B[D])}}}}function K(t,a){const{chainData:n}=t;if(!n)return;const{assemblyManager:o}=A.getSession(t),r=A.getContainingView(t),c=r.assemblyNames[0],u=o.get(c);if(!u)return;F(n)?Z({self:t,view:r,asm:u,ctx:a,chainData:n}):q({self:t,view:r,asm:u,ctx:a,chainData:n})}export{K as drawFeats};
//# sourceMappingURL=drawFeats-BDZk_4vx.js.map
