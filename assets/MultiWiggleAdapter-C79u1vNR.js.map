{"version":3,"file":"MultiWiggleAdapter-C79u1vNR.js","sources":["../node_modules/@jbrowse/plugin-wiggle/esm/MultiWiggleAdapter/MultiWiggleAdapter.js"],"sourcesContent":["import { BaseFeatureDataAdapter, } from '@jbrowse/core/data_adapters/BaseAdapter';\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs';\nimport { SimpleFeature, min, max } from '@jbrowse/core/util';\nimport { merge } from 'rxjs';\nimport { map } from 'rxjs/operators';\nfunction getFilename(uri) {\n    const filename = uri.slice(uri.lastIndexOf('/') + 1);\n    return filename.slice(0, filename.lastIndexOf('.'));\n}\nclass MultiWiggleAdapter extends BaseFeatureDataAdapter {\n    async getAdapters() {\n        const getSubAdapter = this.getSubAdapter;\n        if (!getSubAdapter) {\n            throw new Error('no getSubAdapter available');\n        }\n        let subConfs = this.getConf('subadapters');\n        if (!(subConfs === null || subConfs === void 0 ? void 0 : subConfs.length)) {\n            const entries = this.getConf('bigWigs');\n            subConfs = entries.map(entry => ({\n                type: 'BigWigAdapter',\n                source: getFilename(entry),\n                bigWigLocation: {\n                    uri: entry,\n                },\n            }));\n        }\n        return Promise.all(subConfs.map(async (conf) => {\n            const dataAdapter = (await getSubAdapter(conf))\n                .dataAdapter;\n            return {\n                source: conf.name || dataAdapter.id,\n                ...conf,\n                dataAdapter,\n            };\n        }));\n    }\n    // note: can't really have dis-agreeing refNames\n    async getRefNames(opts) {\n        const adapters = await this.getAdapters();\n        const allNames = await Promise.all(adapters.map(a => a.dataAdapter.getRefNames(opts)));\n        return [...new Set(allNames.flat())];\n    }\n    async getGlobalStats(opts) {\n        const adapters = await this.getAdapters();\n        const stats = (await Promise.all(\n        // @ts-expect-error\n        adapters.map(adp => { var _a, _b; return (_b = (_a = adp.dataAdapter).getGlobalStats) === null || _b === void 0 ? void 0 : _b.call(_a, opts); }))).filter(f => !!f);\n        const scoreMin = min(stats.map(s => s.scoreMin));\n        const scoreMax = max(stats.map(s => s.scoreMax));\n        return { scoreMin, scoreMax };\n    }\n    getFeatures(region, opts = {}) {\n        return ObservableCreate(async (observer) => {\n            const adapters = await this.getAdapters();\n            merge(...adapters.map(adp => adp.dataAdapter.getFeatures(region, opts).pipe(map(p => \n            // add source field if it does not exist\n            p.get('source')\n                ? p\n                : new SimpleFeature({\n                    ...p.toJSON(),\n                    uniqueId: `${adp.source}-${p.id()}`,\n                    source: adp.source,\n                }))))).subscribe(observer);\n        }, opts.signal);\n    }\n    // always render bigwig instead of calculating a feature density for it\n    async getMultiRegionFeatureDensityStats(_regions) {\n        return { featureDensity: 0 };\n    }\n    // in another adapter type, this could be dynamic depending on region or\n    // something, but it is static for this particular multi-wiggle adapter type\n    async getSources() {\n        const adapters = await this.getAdapters();\n        return adapters.map(({ dataAdapter, source, name, ...rest }) => ({\n            name: source,\n            __name: name,\n            ...rest,\n        }));\n    }\n    freeResources() { }\n}\nMultiWiggleAdapter.capabilities = [\n    'hasResolution',\n    'hasLocalStats',\n    'hasGlobalStats',\n];\nexport default MultiWiggleAdapter;\n"],"names":["getFilename","uri","filename","MultiWiggleAdapter","BaseFeatureDataAdapter","getSubAdapter","subConfs","entry","conf","dataAdapter","opts","adapters","allNames","a","stats","adp","_a","_b","f","scoreMin","min","s","scoreMax","max","region","ObservableCreate","observer","merge","map","p","SimpleFeature","_regions","source","name","rest"],"mappings":"mEAKA,SAASA,EAAYC,EAAK,CACtB,MAAMC,EAAWD,EAAI,MAAMA,EAAI,YAAY,GAAG,EAAI,CAAC,EACnD,OAAOC,EAAS,MAAM,EAAGA,EAAS,YAAY,GAAG,CAAC,CACtD,CACA,MAAMC,UAA2BC,EAAAA,sBAAuB,CACpD,MAAM,aAAc,CAChB,MAAMC,EAAgB,KAAK,cAC3B,GAAI,CAACA,EACD,MAAM,IAAI,MAAM,4BAA4B,EAEhD,IAAIC,EAAW,KAAK,QAAQ,aAAa,EACzC,OAAMA,GAAa,MAAuCA,EAAS,SAE/DA,EADgB,KAAK,QAAQ,SAAS,EACnB,IAAIC,IAAU,CAC7B,KAAM,gBACN,OAAQP,EAAYO,CAAK,EACzB,eAAgB,CACZ,IAAKA,CACR,CACjB,EAAc,GAEC,QAAQ,IAAID,EAAS,IAAI,MAAOE,GAAS,CAC5C,MAAMC,GAAe,MAAMJ,EAAcG,CAAI,GACxC,YACL,MAAO,CACH,OAAQA,EAAK,MAAQC,EAAY,GACjC,GAAGD,EACH,YAAAC,CACH,CACb,CAAS,CAAC,CACV,CAEI,MAAM,YAAYC,EAAM,CACpB,MAAMC,EAAW,MAAM,KAAK,YAAa,EACnCC,EAAW,MAAM,QAAQ,IAAID,EAAS,IAAIE,GAAKA,EAAE,YAAY,YAAYH,CAAI,CAAC,CAAC,EACrF,MAAO,CAAC,GAAG,IAAI,IAAIE,EAAS,KAAM,CAAA,CAAC,CAC3C,CACI,MAAM,eAAeF,EAAM,CACvB,MAAMC,EAAW,MAAM,KAAK,YAAa,EACnCG,GAAS,MAAM,QAAQ,IAE7BH,EAAS,IAAII,GAAO,CAAE,IAAIC,EAAIC,EAAI,OAAQA,GAAMD,EAAKD,EAAI,aAAa,kBAAoB,MAAQE,IAAO,OAAS,OAASA,EAAG,KAAKD,EAAIN,CAAI,CAAE,CAAE,CAAC,GAAG,OAAOQ,GAAK,CAAC,CAACA,CAAC,EAC5JC,EAAWC,EAAAA,IAAIN,EAAM,IAAIO,GAAKA,EAAE,QAAQ,CAAC,EACzCC,EAAWC,EAAAA,IAAIT,EAAM,IAAIO,GAAKA,EAAE,QAAQ,CAAC,EAC/C,MAAO,CAAE,SAAAF,EAAU,SAAAG,CAAU,CACrC,CACI,YAAYE,EAAQd,EAAO,GAAI,CAC3B,OAAOe,EAAiB,MAAOC,GAAa,CACxC,MAAMf,EAAW,MAAM,KAAK,YAAa,EACzCgB,EAAM,GAAGhB,EAAS,IAAII,GAAOA,EAAI,YAAY,YAAYS,EAAQd,CAAI,EAAE,KAAKkB,EAAIC,GAEhFA,EAAE,IAAI,QAAQ,EACRA,EACA,IAAIC,gBAAc,CAChB,GAAGD,EAAE,OAAQ,EACb,SAAU,GAAGd,EAAI,MAAM,IAAIc,EAAE,GAAE,CAAE,GACjC,OAAQd,EAAI,MACf,CAAA,CAAC,CAAC,CAAC,CAAC,EAAE,UAAUW,CAAQ,CACzC,EAAWhB,EAAK,MAAM,CACtB,CAEI,MAAM,kCAAkCqB,EAAU,CAC9C,MAAO,CAAE,eAAgB,CAAG,CACpC,CAGI,MAAM,YAAa,CAEf,OADiB,MAAM,KAAK,YAAa,GACzB,IAAI,CAAC,CAAE,YAAAtB,EAAa,OAAAuB,EAAQ,KAAAC,EAAM,GAAGC,MAAY,CAC7D,KAAMF,EACN,OAAQC,EACR,GAAGC,CACf,EAAU,CACV,CACI,eAAgB,CAAA,CACpB,CACA/B,EAAmB,aAAe,CAC9B,gBACA,gBACA,gBACJ","x_google_ignoreList":[0]}