{"version":3,"file":"AddConnectionWidget-DmaoYGwq.js","sources":["../node_modules/@jbrowse/product-core/esm/Session/BaseSession.js","../node_modules/@jbrowse/product-core/esm/Session/Connections.js","../node_modules/@jbrowse/plugin-data-management/esm/AddConnectionWidget/components/ConfigureConnection.js","../node_modules/@mui/icons-material/OpenInNew.js","../node_modules/@jbrowse/plugin-data-management/esm/AddConnectionWidget/components/ConnectionTypeSelect.js","../node_modules/@jbrowse/plugin-data-management/esm/AddConnectionWidget/components/AddConnectionWidget.js"],"sourcesContent":["import { getParent, isStateTreeNode, types, } from 'mobx-state-tree';\nimport { ElementId } from '@jbrowse/core/util/types/mst';\n/**\n * #stateModel BaseSessionModel\n *\n * base session shared by all JBrowse products. Be careful what you include\n * here, everything will use it.\n */\nexport function BaseSessionModel(_pluginManager) {\n    return types\n        .model({\n        /**\n         * #property\n         */\n        id: ElementId,\n        /**\n         * #property\n         */\n        name: types.string,\n        /**\n         * #property\n         */\n        margin: 0,\n    })\n        .volatile(() => ({\n        /**\n         * #volatile\n         * this is the globally \"selected\" object. can be anything. code that\n         * wants to deal with this should examine it to see what kind of thing it\n         * is.\n         */\n        selection: undefined,\n        /**\n         * #volatile\n         * this is the globally \"hovered\" object. can be anything. code that\n         * wants to deal with this should examine it to see what kind of thing it\n         * is.\n         */\n        hovered: undefined,\n    }))\n        .views(self => ({\n        /**\n         * #getter\n         */\n        get root() {\n            return getParent(self);\n        },\n    }))\n        .views(self => ({\n        /**\n         * #getter\n         */\n        get jbrowse() {\n            return self.root.jbrowse;\n        },\n        /**\n         * #getter\n         */\n        get rpcManager() {\n            return self.root.rpcManager;\n        },\n        /**\n         * #getter\n         */\n        get configuration() {\n            return this.jbrowse.configuration;\n        },\n        /**\n         * #getter\n         */\n        get adminMode() {\n            return self.root.adminMode;\n        },\n        /**\n         * #getter\n         */\n        get textSearchManager() {\n            return self.root.textSearchManager;\n        },\n    }))\n        .views(self => ({\n        /**\n         * #getter\n         */\n        get assemblies() {\n            return self.jbrowse.assemblies;\n        },\n    }))\n        .actions(self => ({\n        /**\n         * #action\n         * set the global selection, i.e. the globally-selected object. can be a\n         * feature, a view, just about anything\n         */\n        setSelection(thing) {\n            self.selection = thing;\n        },\n        /**\n         * #action\n         * clears the global selection\n         */\n        clearSelection() {\n            self.selection = undefined;\n        },\n        /**\n         * #action\n         */\n        setHovered(thing) {\n            self.hovered = thing;\n        },\n    }));\n}\n/** Type guard for BaseSession */\nexport function isBaseSession(thing) {\n    return 'id' in thing && 'name' in thing && 'root' in thing;\n}\n/** Type guard for whether a thing is JBrowse session */\nexport function isSession(thing) {\n    return isStateTreeNode(thing) && isBaseSession(thing);\n}\n","import { readConfObject, } from '@jbrowse/core/configuration';\nimport { types } from 'mobx-state-tree';\nimport { isBaseSession } from './BaseSession';\n/**\n * #stateModel ConnectionManagementSessionMixin\n */\nexport function ConnectionManagementSessionMixin(pluginManager) {\n    return types\n        .model({\n        /**\n         * #property\n         */\n        connectionInstances: types.array(pluginManager.pluggableMstType('connection', 'stateModel')),\n    })\n        .views(self => ({\n        /**\n         * #getter\n         */\n        get connections() {\n            const { jbrowse } = self;\n            return jbrowse.connections;\n        },\n    }))\n        .actions(self => ({\n        /**\n         * #action\n         */\n        makeConnection(configuration, initialSnapshot = {}) {\n            const type = configuration.type;\n            if (!type) {\n                throw new Error('track configuration has no `type` listed');\n            }\n            const name = readConfObject(configuration, 'name');\n            const connectionType = pluginManager.getConnectionType(type);\n            if (!connectionType) {\n                throw new Error(`unknown connection type ${type}`);\n            }\n            const length = self.connectionInstances.push({\n                ...initialSnapshot,\n                name,\n                // @ts-expect-error unsure why ts doesn't like `type` here, but is\n                // needed\n                type,\n                configuration,\n            });\n            return self.connectionInstances[length - 1];\n        },\n        /**\n         * #action\n         */\n        prepareToBreakConnection(configuration) {\n            const root = self;\n            const callbacksToDeref = [];\n            const derefTypeCount = {};\n            const name = readConfObject(configuration, 'name');\n            const connection = self.connectionInstances.find(c => c.name === name);\n            if (!connection) {\n                return undefined;\n            }\n            for (const track of connection.tracks) {\n                const ref = root.getReferring(track);\n                root.removeReferring(ref, track, callbacksToDeref, derefTypeCount);\n            }\n            return [\n                () => {\n                    callbacksToDeref.forEach(cb => {\n                        cb();\n                    });\n                    this.breakConnection(configuration);\n                },\n                derefTypeCount,\n            ];\n        },\n        /**\n         * #action\n         */\n        breakConnection(configuration) {\n            const name = readConfObject(configuration, 'name');\n            const connection = self.connectionInstances.find(c => c.name === name);\n            if (!connection) {\n                throw new Error(`no connection found with name ${name}`);\n            }\n            self.connectionInstances.remove(connection);\n        },\n        /**\n         * #action\n         */\n        deleteConnection(configuration) {\n            const { jbrowse } = self;\n            return jbrowse.deleteConnectionConf(configuration);\n        },\n        /**\n         * #action\n         */\n        addConnectionConf(connectionConf) {\n            const { jbrowse } = self;\n            return jbrowse.addConnectionConf(connectionConf);\n        },\n        /**\n         * #action\n         */\n        clearConnections() {\n            self.connectionInstances.clear();\n        },\n    }));\n}\n/** Type guard for SessionWithConnections */\nexport function isSessionWithConnections(session) {\n    return isBaseSession(session) && 'connectionInstances' in session;\n}\n","import React, { Suspense } from 'react';\nimport { observer } from 'mobx-react';\nimport { ConfigurationEditor } from '@jbrowse/plugin-config';\nimport { LoadingEllipses } from '@jbrowse/core/ui';\nconst ConfigureConnection = observer(function ({ connectionType, model, session, }) {\n    const ConfigEditorComponent = connectionType.configEditorComponent || ConfigurationEditor;\n    return (React.createElement(Suspense, { fallback: React.createElement(LoadingEllipses, null) },\n        React.createElement(ConfigEditorComponent, { model: { target: model }, session: session })));\n});\nexport default ConfigureConnection;\n","\"use strict\";\n\"use client\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nvar _createSvgIcon = _interopRequireDefault(require(\"./utils/createSvgIcon\"));\nvar _jsxRuntime = require(\"react/jsx-runtime\");\nvar _default = exports.default = (0, _createSvgIcon.default)( /*#__PURE__*/(0, _jsxRuntime.jsx)(\"path\", {\n  d: \"M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3z\"\n}), 'OpenInNew');","import React, { useEffect } from 'react';\nimport { IconButton, MenuItem, TextField } from '@mui/material';\nimport { observer } from 'mobx-react';\n// icons\nimport OpenInNewIcon from '@mui/icons-material/OpenInNew';\nconst ConnectionTypeSelect = observer(function ConnectionTypeSelect({ connectionTypeChoices, connectionType, setConnectionType, }) {\n    const firstChoice = connectionTypeChoices[0];\n    useEffect(() => {\n        if (!connectionType) {\n            setConnectionType(firstChoice);\n        }\n    }, [connectionType, firstChoice, setConnectionType]);\n    return (React.createElement(\"form\", { autoComplete: \"off\" }, connectionType ? (React.createElement(TextField, { value: connectionType.name, label: \"connectionType\", helperText: connectionType.description ? (React.createElement(React.Fragment, null,\n            connectionType.description,\n            connectionType.url ? (React.createElement(IconButton, { href: connectionType.url, rel: \"noopener noreferrer\", target: \"_blank\" },\n                React.createElement(OpenInNewIcon, null))) : null)) : null, select: true, fullWidth: true, onChange: event => {\n            setConnectionType(connectionTypeChoices.find(c => c.name === event.target.value));\n        }, variant: \"outlined\" }, connectionTypeChoices.map(c => (React.createElement(MenuItem, { key: c.name, value: c.name }, c.displayName || c.name))))) : null));\n});\nexport default ConnectionTypeSelect;\n","import React, { useMemo, useState } from 'react';\nimport { Button, Step, StepContent, StepLabel, Stepper } from '@mui/material';\nimport { getSession, getEnv, isSessionModelWithWidgets, } from '@jbrowse/core/util';\nimport { makeStyles } from 'tss-react/mui';\nimport { observer } from 'mobx-react';\n// locals\nimport ConfigureConnection from './ConfigureConnection';\nimport ConnectionTypeSelect from './ConnectionTypeSelect';\nimport { isSessionWithConnections } from '@jbrowse/product-core';\nconst useStyles = makeStyles()(theme => ({\n    root: {\n        marginTop: theme.spacing(1),\n    },\n    stepper: {\n        backgroundColor: theme.palette.background.default,\n    },\n    button: {\n        marginTop: theme.spacing(1),\n        marginRight: theme.spacing(1),\n    },\n    actionsContainer: {\n        marginBottom: theme.spacing(2),\n    },\n}));\nconst steps = ['Select a Connection Type', 'Configure Connection'];\nconst AddConnectionWidget = observer(function ({ model }) {\n    const [connectionType, setConnectionType] = useState();\n    const [connectionId, setConnectionId] = useState();\n    const [activeStep, setActiveStep] = useState(0);\n    const { classes } = useStyles();\n    const session = getSession(model);\n    const { pluginManager } = getEnv(session);\n    // useMemo is needed for react@18+mobx-react@9, previous code called configScema.create directly in a setConfigModel useState hook setter but this caused infinite loop\n    const configModel = useMemo(() => connectionType === null || connectionType === void 0 ? void 0 : connectionType.configSchema.create({ connectionId }, getEnv(model)), [connectionId, connectionType, model]);\n    return (React.createElement(\"div\", { className: classes.root },\n        React.createElement(Stepper, { className: classes.stepper, activeStep: activeStep, orientation: \"vertical\" }, steps.map(label => (React.createElement(Step, { key: label },\n            React.createElement(StepLabel, null, label),\n            React.createElement(StepContent, null,\n                activeStep === 0 ? (React.createElement(ConnectionTypeSelect, { connectionTypeChoices: pluginManager.getConnectionElements(), connectionType: connectionType, setConnectionType: c => {\n                        setConnectionType(c);\n                        if (!c) {\n                            return;\n                        }\n                        setConnectionId(`${c.name}-${Date.now()}`);\n                    } })) : connectionType && configModel ? (React.createElement(ConfigureConnection, { connectionType: connectionType, model: configModel, session: session })) : null,\n                React.createElement(\"div\", { className: classes.actionsContainer },\n                    React.createElement(Button, { disabled: activeStep === 0, onClick: () => {\n                            setActiveStep(activeStep - 1);\n                        }, className: classes.button }, \"Back\"),\n                    React.createElement(Button, { disabled: !((activeStep === 0 && connectionType) ||\n                            (activeStep === 1 && configModel)), variant: \"contained\", color: \"primary\", onClick: () => {\n                            if (activeStep === steps.length - 1) {\n                                if (configModel && isSessionWithConnections(session)) {\n                                    const conf = session.addConnectionConf(configModel);\n                                    session.makeConnection(conf);\n                                }\n                                else {\n                                    session.notify('No config model to add');\n                                }\n                                if (isSessionModelWithWidgets(session)) {\n                                    session.hideWidget(model);\n                                }\n                            }\n                            else {\n                                setActiveStep(activeStep + 1);\n                            }\n                        }, className: classes.button, \"data-testid\": \"addConnectionNext\" }, activeStep === steps.length - 1 ? 'Connect' : 'Next')))))))));\n});\nexport default AddConnectionWidget;\n"],"names":["isBaseSession","thing","isSessionWithConnections","session","ConfigureConnection","observer","connectionType","model","ConfigEditorComponent","ConfigurationEditor","React","Suspense","LoadingEllipses","_interopRequireDefault","require$$0","OpenInNew","default_1","_createSvgIcon","require$$1","_jsxRuntime","require$$2","ConnectionTypeSelect","connectionTypeChoices","setConnectionType","firstChoice","useEffect","TextField","IconButton","OpenInNewIcon","event","c","MenuItem","useStyles","makeStyles","theme","steps","AddConnectionWidget","useState","connectionId","setConnectionId","activeStep","setActiveStep","classes","getSession","pluginManager","getEnv","configModel","useMemo","Stepper","label","Step","StepLabel","StepContent","Button","conf","isSessionModelWithWidgets"],"mappings":"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","x_google_ignoreList":[0,1,2,3,4,5]}