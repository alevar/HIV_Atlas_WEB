import{I,l as h,Q as p,O as x,J as H,a2 as _}from"./index-CYW4W05g.js";import{T as b}from"./tabixIndexedFile-rQBx9loD.js";import{p as F,f as L}from"./featureData-XuIg4mRh.js";class O extends I.BaseFeatureDataAdapter{constructor(e,n,i){super(e,n,i);const a=h.readConfObject(e,"gffGzLocation"),l=h.readConfObject(e,["index","indexType"]),o=h.readConfObject(e,["index","location"]),d=h.readConfObject(e,"dontRedispatch");this.dontRedispatch=d||["chromosome","contig","region"],this.gff=new b({filehandle:p.openLocation(a,this.pluginManager),csiFilehandle:l==="CSI"?p.openLocation(o,this.pluginManager):void 0,tbiFilehandle:l!=="CSI"?p.openLocation(o,this.pluginManager):void 0,chunkCacheSize:50*2**20,renameRefSeqs:c=>c})}async getRefNames(e={}){return this.gff.getReferenceSequenceNames(e)}async getHeader(){return this.gff.getHeader()}getFeatures(e,n={}){return x(async i=>{const a=await this.gff.getMetadata();await this.getFeaturesHelper(e,n,a,i,!0)},n.signal)}async getFeaturesHelper(e,n,i,a,l,o=e){var d,c;try{const r=[];if(await this.gff.getLines(e.refName,e.start,e.end,(t,s)=>{r.push(this.parseLine(i.columnNumbers,t,s))}),l&&r.length){let t=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;for(const f of r){const m=f.fields[2];if(!this.dontRedispatch.includes(m)){const u=f.start-1;u<t&&(t=u),f.end>s&&(s=f.end)}}if(s>e.end||t<e.start){await this.getFeaturesHelper({...e,start:t,end:s},n,i,a,!1,e);return}}const g=r.map(t=>(t.fields[8]&&t.fields[8]!=="."?t.fields[8].includes("_lineHash")||(t.fields[8]+=`;_lineHash=${t.lineHash}`):t.fields[8]=`_lineHash=${t.lineHash}`,t.fields.join("	"))).join(`
`);for(const t of F(g))for(const s of t){const f=new H({data:L(s),id:`${this.id}-offset-${(c=(d=s.attributes)===null||d===void 0?void 0:d._lineHash)===null||c===void 0?void 0:c[0]}`});_(f.get("start"),f.get("end"),o.start,o.end)&&a.next(f)}a.complete()}catch(r){a.error(r)}}parseLine(e,n,i){const a=n.split("	");return{start:+a[e.start-1],end:+a[e.end-1],lineHash:i,fields:a}}freeResources(){}}export{O as default};
//# sourceMappingURL=Gff3TabixAdapter-DPcFNcLg.js.map
