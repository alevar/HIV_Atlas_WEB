{"version":3,"file":"GroupByDialog-DpiYiEel.js","sources":["../node_modules/@jbrowse/plugin-alignments/esm/LinearPileupDisplay/components/GroupByDialog.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { observer } from 'mobx-react';\nimport { Button, Checkbox, DialogActions, DialogContent, FormControlLabel, TextField, Typography, } from '@mui/material';\nimport { Dialog, ErrorMessage, LoadingEllipses } from '@jbrowse/core/ui';\nimport { getSnapshot } from 'mobx-state-tree';\nimport { getContainingTrack, getContainingView, getSession, useDebounce, } from '@jbrowse/core/util';\n// locals\nimport { getUniqueTagValues } from '../../shared';\nfunction clone(c) {\n    return JSON.parse(JSON.stringify(c));\n}\nconst GroupByTagDialog = observer(function (props) {\n    const { model, handleClose } = props;\n    const [tag, setTag] = useState('');\n    const [tagSet, setTagSet] = useState();\n    const [loading, setLoading] = useState(false);\n    const [error, setError] = useState();\n    const [includeUndefined, setIncludeUndefined] = useState(true);\n    const validTag = /^[A-Za-z][A-Za-z0-9]$/.exec(tag);\n    const isInvalid = tag.length === 2 && !validTag;\n    const debouncedTag = useDebounce(tag, 1000);\n    useEffect(() => {\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        ;\n        (async () => {\n            try {\n                if (!isInvalid) {\n                    setError(undefined);\n                    setLoading(true);\n                    const vals = await getUniqueTagValues({\n                        self: model,\n                        tag: debouncedTag,\n                        blocks: getContainingView(model)\n                            .staticBlocks,\n                    });\n                    setTagSet(vals);\n                }\n            }\n            catch (e) {\n                console.error(e);\n                setError(e);\n            }\n            finally {\n                setLoading(false);\n            }\n        })();\n    }, [model, isInvalid, debouncedTag]);\n    return (React.createElement(Dialog, { open: true, onClose: handleClose, title: \"Group by tag\" },\n        React.createElement(DialogContent, null,\n            React.createElement(Typography, null, \"Set the tag to group by. NOTE: this will make a set of fully functional subtracks with the filter by by default set to the values of the tag that are visible in the current view\"),\n            React.createElement(Typography, { color: \"textSecondary\" }, \"Examples: HP for haplotype, RG for read group, etc.\"),\n            React.createElement(FormControlLabel, { control: React.createElement(Checkbox, { checked: includeUndefined, onChange: () => {\n                        setIncludeUndefined(!includeUndefined);\n                    } }), label: \"Make a new subtrack for undefined values of tag as well?\" }),\n            React.createElement(TextField, { value: tag, onChange: event => {\n                    setTag(event.target.value);\n                }, placeholder: \"Enter tag name\", inputProps: {\n                    maxLength: 2,\n                    'data-testid': 'group-tag-name-input',\n                }, error: isInvalid, helperText: isInvalid ? 'Not a valid tag' : '', autoComplete: \"off\", \"data-testid\": \"group-tag-name\" }),\n            error ? (React.createElement(ErrorMessage, { error: error })) : loading ? (React.createElement(LoadingEllipses, { title: \"Loading unique tags\" })) : tagSet ? (React.createElement(\"div\", null,\n                React.createElement(\"div\", null,\n                    \"Found unique \",\n                    tag,\n                    \" values:\"),\n                React.createElement(\"div\", null, tagSet.join(', ')))) : null),\n        React.createElement(DialogActions, null,\n            React.createElement(Button, { variant: \"contained\", color: \"primary\", type: \"submit\", disabled: !tagSet, autoFocus: true, onClick: () => {\n                    const track = getContainingTrack(model);\n                    const trackConf = clone(getSnapshot(track.configuration));\n                    const session = getSession(model);\n                    if (tagSet) {\n                        const ret = [...tagSet];\n                        if (includeUndefined) {\n                            ret.push(undefined);\n                        }\n                        for (const tagValue of ret) {\n                            // @ts-expect-error\n                            const newTrackConf = session.addTrackConf({\n                                ...trackConf,\n                                trackId: `${trackConf.trackId}-${tag}:${tagValue}-${+Date.now()}-sessionTrack`,\n                                name: `${trackConf.name} ${tag}:${tagValue}`,\n                                displays: undefined,\n                            });\n                            const view = getContainingView(model);\n                            const t = view.showTrack(newTrackConf.trackId);\n                            const d = t.displays[0];\n                            d.setFilterBy({\n                                flagInclude: 0,\n                                flagExclude: 1540,\n                                tagFilter: {\n                                    tag,\n                                    value: tagValue,\n                                },\n                            });\n                        }\n                    }\n                    handleClose();\n                } }, \"Submit\"),\n            React.createElement(Button, { variant: \"contained\", color: \"secondary\", onClick: () => {\n                    handleClose();\n                } }, \"Cancel\"))));\n});\nexport default GroupByTagDialog;\n"],"names":["clone","GroupByTagDialog","observer","props","model","handleClose","tag","setTag","useState","tagSet","setTagSet","loading","setLoading","error","setError","includeUndefined","setIncludeUndefined","validTag","isInvalid","debouncedTag","useDebounce","useEffect","vals","getUniqueTagValues","getContainingView","e","React","Dialog","DialogContent","Typography","FormControlLabel","Checkbox","TextField","event","ErrorMessage","LoadingEllipses","DialogActions","Button","track","getContainingTrack","trackConf","getSnapshot","session","getSession","ret","tagValue","newTrackConf"],"mappings":"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","x_google_ignoreList":[0]}