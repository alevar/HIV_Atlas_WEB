import{z as k,u as z,Q as R}from"./index-Do-r7xR6.js";/*!
 * isobject <https://github.com/jonschlinkert/isobject>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var P=function(t){return t!=null&&typeof t=="object"&&Array.isArray(t)===!1};/*!
 * get-value <https://github.com/jonschlinkert/get-value>
 *
 * Copyright (c) 2014-2018, Jon Schlinkert.
 * Released under the MIT License.
 */const _=P;var M=function(e,t,r){if(_(r)||(r={default:r}),!F(e))return typeof r.default<"u"?r.default:e;typeof t=="number"&&(t=String(t));const s=Array.isArray(t),n=typeof t=="string",i=r.separator||".",c=r.joinChar||(typeof i=="string"?i:".");if(!n&&!s)return e;if(n&&t in e)return j(t,e,r)?e[t]:r.default;let o=s?t:D(t,i,r),u=o.length,a=0;do{let f=o[a];for(typeof f=="number"&&(f=String(f));f&&f.slice(-1)==="\\";)f=J([f.slice(0,-1),o[++a]||""],c,r);if(f in e){if(!j(f,e,r))return r.default;e=e[f]}else{let d=!1,l=a+1;for(;l<u;)if(f=J([f,o[l++]],c,r),d=f in e){if(!j(f,e,r))return r.default;e=e[f],a=l-1;break}if(!d)return r.default}}while(++a<u&&F(e));return a===u?e:r.default};function J(e,t,r){return typeof r.join=="function"?r.join(e):e[0]+t+e[1]}function D(e,t,r){return typeof r.split=="function"?r.split(e):e.split(t)}function j(e,t,r){return typeof r.isValid=="function"?r.isValid(e,t):!0}function F(e){return _(e)||Array.isArray(e)||typeof e=="function"}const L=k(M);/*!
 * is-primitive <https://github.com/jonschlinkert/is-primitive>
 *
 * Copyright (c) 2014-present, Jon Schlinkert.
 * Released under the MIT License.
 */var W=function(t){return typeof t=="object"?t===null:typeof t!="function"};/*!
 * is-plain-object <https://github.com/jonschlinkert/is-plain-object>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var K=P;function v(e){return K(e)===!0&&Object.prototype.toString.call(e)==="[object Object]"}var G=function(t){var r,s;return!(v(t)===!1||(r=t.constructor,typeof r!="function")||(s=r.prototype,v(s)===!1)||s.hasOwnProperty("isPrototypeOf")===!1)};/*!
 * set-value <https://github.com/jonschlinkert/set-value>
 *
 * Copyright (c) Jon Schlinkert (https://github.com/jonschlinkert).
 * Released under the MIT License.
 */const{deleteProperty:N}=Reflect,H=W,x=G,q=e=>typeof e=="object"&&e!==null||typeof e=="function",Q=e=>e==="__proto__"||e==="constructor"||e==="prototype",B=e=>{if(!H(e))throw new TypeError("Object keys must be strings or symbols");if(Q(e))throw new Error(`Cannot set unsafe key: "${e}"`)},X=e=>Array.isArray(e)?e.flat().map(String).join(","):e,Y=(e,t)=>{if(typeof e!="string"||!t)return e;let r=e+";";return t.arrays!==void 0&&(r+=`arrays=${t.arrays};`),t.separator!==void 0&&(r+=`separator=${t.separator};`),t.split!==void 0&&(r+=`split=${t.split};`),t.merge!==void 0&&(r+=`merge=${t.merge};`),t.preservePaths!==void 0&&(r+=`preservePaths=${t.preservePaths};`),r},Z=(e,t,r)=>{const s=X(t?Y(e,t):e);B(s);const n=y.cache.get(s)||r();return y.cache.set(s,n),n},C=(e,t={})=>{const r=t.separator||".",s=r==="/"?!1:t.preservePaths;if(typeof e=="string"&&s!==!1&&/\//.test(e))return[e];const n=[];let i="";const c=o=>{let u;o.trim()!==""&&Number.isInteger(u=Number(o))?n.push(u):n.push(o)};for(let o=0;o<e.length;o++){const u=e[o];if(u==="\\"){i+=e[++o];continue}if(u===r){c(i),i="";continue}i+=u}return i&&c(i),n},T=(e,t)=>t&&typeof t.split=="function"?t.split(e):typeof e=="symbol"?[e]:Array.isArray(e)?e:Z(e,t,()=>C(e,t)),ee=(e,t,r,s)=>{if(B(t),r===void 0)N(e,t);else if(s&&s.merge){const n=s.merge==="function"?s.merge:Object.assign;n&&x(e[t])&&x(r)?e[t]=n(e[t],r):e[t]=r}else e[t]=r;return e},y=(e,t,r,s)=>{if(!t||!q(e))return e;const n=T(t,s);let i=e;for(let c=0;c<n.length;c++){const o=n[c],u=n[c+1];if(B(o),u===void 0){ee(i,o,r,s);break}if(typeof u=="number"&&!Array.isArray(i[o])){i=i[o]=[];continue}q(i[o])||(i[o]={}),i=i[o]}return e};y.split=T;y.cache=new Map;y.clear=()=>{y.cache=new Map};var re=y;const te=k(re);function E(e){return(e==null?void 0:e.label)&&typeof e.label=="string"}function se(e){return(e==null?void 0:e.url)&&typeof e.url=="string"}function U(e,t){for(const r of Object.keys(t))r in e&&typeof t[r]=="object"&&typeof e[r]=="object"?U(e[r],t[r]):(e[r]===void 0||t[r]!==void 0)&&(e[r]=t[r]);return e}function ne(e,t){return e.replaceAll(/{([\s\w.]+)}/g,(r,s)=>{s=s.replaceAll(/\s+/g,"");const n=L(t,s);if(n!==void 0)return typeof n=="function"?n(s):n;if(t.callback){const i=t.callback.call(this,s);if(i!==void 0)return i}return r})}function w(e){if(!e||typeof e!="object"||Object.prototype.toString.call(e)==="[object Function]")return e;if(e.nodeType&&"cloneNode"in e)return e.cloneNode(!0);if(e instanceof Date)return new Date(e.getTime());if(e instanceof RegExp)return new RegExp(e);let t;if(Array.isArray(e)){t=[];for(let r=0,s=e.length;r<s;++r)r in e&&(t[r]=w(e[r]))}else t=e.constructor?new e.constructor:{};return ie(t,e,w)}function ie(e,t,r){const s={};for(const n in t){const i=t[n];(!(n in e)||e[n]!==i&&(!(n in s)||s[n]!==i))&&(e[n]=r?r(i):i)}return e}function oe(e,t){if(typeof e=="string"){let r;try{r=JSON.parse(e)}catch(s){throw new Error(`${s} when parsing configuration.`)}return S(r,t)}return S(e,t)}function ae(e,t){let r;try{r=fe(e,t)}catch(s){throw new Error(`${s} when parsing configuration.`)}return S(r,t)}function ue(e){return e==="include"}function fe(e,t){let r=[],s,n,i;const c={tracks:{}};let o;function u(){if(i!==void 0){let a;try{const f=/^json:(.+)/i.exec(i);if(f?a=JSON.parse(f[1]):/^[+-]?[\d.,]+([eE][-+]?\d+)?$/.test(i)?a=Number.parseFloat(i.replaceAll(",","")):a=i,!s)throw new Error(`Error parsing in section ${r.join(" - ")}`);const d=[...r,...s].join(".");if(n==="+="){let l=L(c,d);l?Array.isArray(l)||(l=[l]):l=[],l.push(a),a=l}a==="true"&&(a=!0),a==="false"&&(a=!1),te(c,d,a)}catch{throw new Error(`syntax error${t?` in ${t}`:""}${o?` at line ${o-1}`:""}`)}}}return e.split(/\n|\r\n|\r/).forEach((a,f)=>{o=f+1;const d=a.replace(/^\s*#.+/,"");let l;if(l=/^\s*\[([^\]]+)/.exec(d))u(),s=void 0,i=void 0,r=l[1].trim().split(/\s*\.\s*/),r.length===1&&r[0].toLowerCase()==="general"&&(r=[]);else if(l=d.match(i===void 0?/^([^+=]+)(\+?=)(.*)/:/^(\S[^+=]+)(\+?=)(.*)/))u(),s=l[1].trim().split(/\s*\.\s*/),[,,n]=l,ue([...r,...s].join("."))&&(n="+="),i=l[3].trim();else if(s!==void 0&&(l=/^\s{0,4}\+\s*(.+)/.exec(d)))u(),n="+=",i=l[1].trim();else if(i!==void 0&&(l=/^\s+(\S.*)/.exec(d))){const A=l[1];i+=i.length?` ${A.trim()}`:A.trim()}else u(),s=void 0,i=void 0}),u(),c}function S(e,t){if(e.tracks&&!Array.isArray(e.tracks))if(E(e.tracks))e.tracks=[e.tracks];else{const s=[];for(const n of Object.keys(e.tracks)){const i=e.tracks[n];E(i)?s.push(i):s.push({label:n,...i})}e.tracks=s}const r=e.trackMetadata;if(r!=null&&r.sources){if(typeof r.sources=="string"&&(r.sources=[r.sources]),se(r.sources)&&(r.sources=[r.sources]),!Array.isArray(r.sources)){const s=[];for(const n of Object.keys(r.sources)){const i=r.sources[n];"name"in i||(i.name=n),s.push(i)}r.sources=s}r.sources=r.sources.map(s=>{if(typeof s=="string"){const n={url:s},i=/\.(\w+)$/.exec(s);return i&&(n.type=i[1].toLowerCase()),n}return s})}if(e.sourceUrl=e.sourceUrl||t,e.sourceUrl.startsWith("/")&&(e.sourceUrl=new URL(e.sourceUrl,window.location.href).href),e.baseUrl=e.baseUrl||new URL(".",e.sourceUrl).href,e.baseUrl.length&&!e.baseUrl.endsWith("/")&&(e.baseUrl+="/"),e.sourceUrl){const s=[];e.tracks&&s.push(...e.tracks),e.stores&&s.push(...Object.values(e.stores)),e.names&&s.push(e.names),s.forEach(n=>{n.baseUrl||(n.baseUrl=e.baseUrl||"/")}),e.refSeqs&&typeof e.refSeqs=="string"&&(e.refSeqs=new URL(e.refSeqs,e.sourceUrl).href),e.nameUrl&&(e.nameUrl=new URL(e.nameUrl,e.sourceUrl).href)}return e.stores=e.stores||{},(e.tracks||[]).forEach(s=>{if(s.config){const i=s.config;s.config=void 0,s={...i,...s}}if(s.store)return;let n;s.type==="FeatureTrack"?n="JBrowse/View/Track/HTMLFeatures":s.type==="ImageTrack"?n="JBrowse/View/Track/FixedImage":s.type==="ImageTrack.Wiggle"?n="JBrowse/View/Track/FixedImage/Wiggle":s.type==="SequenceTrack"?n="JBrowse/View/Track/Sequence":n=V("JBrowse/View/Track",s.type),s.type=n,O(e,s),s.histograms&&(s.histograms.baseUrl||(s.histograms.baseUrl=s.baseUrl),O(e,s.histograms))}),e}function V(e,t){return t?(t.includes("/")||(t=`${e}/${t}`),t=t.replace(/^\//,""),t):""}function le(e,t){var r,s;return e?!((r=e.type)===null||r===void 0)&&r.includes("/FixedImage")?`JBrowse/Store/TiledImage/Fixed${e.backendVersion===0?"_v0":""}`:/\.jsonz?$/i.test(t)?`JBrowse/Store/SeqFeature/NCList${e.backendVersion===0?"_v0":""}`:/\.bam$/i.test(t)?"JBrowse/Store/SeqFeature/BAM":/\.cram$/i.test(t)?"JBrowse/Store/SeqFeature/CRAM":/\.gff3?$/i.test(t)?"JBrowse/Store/SeqFeature/GFF3":/\.bed$/i.test(t)?"JBrowse/Store/SeqFeature/BED":/\.vcf.b?gz$/i.test(t)?"JBrowse/Store/SeqFeature/VCFTabix":/\.gff3?.b?gz$/i.test(t)?"JBrowse/Store/SeqFeature/GFF3Tabix":/\.bed.b?gz$/i.test(t)?"JBrowse/Store/SeqFeature/BEDTabix":/\.(bw|bigwig)$/i.test(t)?"JBrowse/Store/SeqFeature/BigWig":/\.(bb|bigbed)$/i.test(t)?"JBrowse/Store/SeqFeature/BigBed":/\.(fa|fasta)$/i.test(t)?"JBrowse/Store/SeqFeature/IndexedFasta":/\.(fa|fasta)\.b?gz$/i.test(t)?"JBrowse/Store/SeqFeature/BgzipIndexedFasta":/\.2bit$/i.test(t)?"JBrowse/Store/SeqFeature/TwoBit":!((s=e.type)===null||s===void 0)&&s.endsWith("/Sequence")?"JBrowse/Store/Sequence/StaticChunked":"":""}function O(e,t){var r;const{urlTemplate:s=""}=t,n=t.storeClass?V("JBrowse/Store",t.storeClass):le(t,s);if(!n){console.warn(`Unable to determine an appropriate data store to use with track '${t.label}', please explicitly specify a storeClass in the configuration.`);return}const i={...t,type:n};i.name=(n==="JBrowse/Store/Sequence/StaticChunked"||n==="JBrowse/Store/Sequence/IndexedFasta"||n==="JBrowse/Store/SeqFeature/IndexedFasta"||n==="JBrowse/Store/SeqFeature/BgzipIndexedFasta"||n==="JBrowse/Store/SeqFeature/TwoBit"||n==="JBrowse/Store/Sequence/TwoBit"||t.useAsRefSeqStore)&&!(!((r=e.stores)===null||r===void 0)&&r.refseqs)?"refseqs":`store${z.objectHash(i)}`,e.stores||(e.stores={}),e.stores[i.name]=i,t.store=i.name}function m(e){return e.uri!==void 0}function p(e){return e.localPath!==void 0}async function Se(e={uri:"",locationType:"UriLocation"},t={include:["{dataRoot}/trackList.json","{dataRoot}/tracks.conf"]},r={uri:"",locationType:"UriLocation"}){const s="uri"in e?"uri":"localPath",n=JSON.parse(JSON.stringify(e));let i="";if(m(e)&&(i=e.uri),p(e)&&(i=e.localPath),i.endsWith("/")&&(n[s]=i.slice(0,-1)),m(r)&&r.uri||p(r)&&r.localPath){const o="uri"in r?"uri":"localPath";let u="";m(r)&&(u=r.uri),p(r)&&(u=r.localPath),u.endsWith("/")&&(u=u.slice(0,-1));let a={};for(const f of["jbrowse.conf","jbrowse_conf.json"]){let d=null;try{d=await I({[o]:`${u}/${f}`})}catch{console.error(`tried to access ${u}/${f}, but failed`)}a=h(a,d)||{}}return n[s]&&(a.dataRoot=n[s]),g(a)}const c=S(t,window.location.href);return n[s]&&(c.dataRoot=n[s]),g(c)}async function g(e,t=he){const r=U(w(t),e);let s=await de(r);return s=h(s,e)||s,b(s,s),me(s),s}async function I(e){const t=await R.openLocation(e).readFile("utf8");return m(e)?$(t,e.uri):p(e)?$(t,e.localPath):$(t)}function $(e,t=""){return e.trim().startsWith("{")?oe(e,t):ae(e,t)}function h(e,t){if(t===null)return null;e===null&&(e={});for(const r of Object.keys(t))if(r==="tracks"&&r in e){const s=e[r]||[],n=t[r]||[];if(Array.isArray(s)&&Array.isArray(n))e[r]=ce(s,n);else throw new Error(`Track config has not been properly regularized: ${s} ${n}`)}else!we(r)&&r in e&&typeof t[r]=="object"&&typeof e[r]=="object"?e[r]=U(e[r],t[r]):r==="dataRoot"?(e[r]===void 0||e[r]==="data"&&t[r]!==void 0)&&(e[r]=t[r]):(e[r]===void 0||t[r]!==void 0)&&(e[r]=t[r]);return e}function ce(e,t){if(!t.length)return e;const r={};return e.forEach((s,n)=>{s.index=n,r[s.label]=s}),t.forEach(s=>{const n=r[s.label];n?h(n,s):e.push(s)}),e}async function de(e){e=w(e);async function t(r,s){const n=r.sourceUrl||r.baseUrl;if(!n)throw new Error(`Could not determine source URL: ${JSON.stringify(r)}`);const i=h(w(s),r);if(!i)throw new Error("Problem merging configs");const c=b(ye(r.include||[]),i);r.include=void 0;const o=c.map(async a=>{a.cacheBuster=e.cacheBuster;const f=await I({uri:new URL(a.url,n).href,locationType:"UriLocation"});return t(f,i)});return(await Promise.all(o)).forEach(a=>{r=h(r,a)||r}),r}return t(e,{})}function ye(e){return e?(Array.isArray(e)||(e=[e]),e.map(t=>(typeof t=="string"&&(t={url:t}),"format"in t||(t.format=t.url.endsWith(".conf")?"conf":"JB_json"),t.format==="JB_json"&&!("version"in t)&&(t.version=1),t))):[]}function b(e,t){if(!e)return e;if(Array.isArray(e))for(let r=0;r<e.length;r+=1)e[r]=b(e[r],t);else if(typeof e=="object"){const r=e;for(const s of Object.keys(r))r[s]=b(r[s],t)}else if(typeof e=="string")return ne(e,t);return e}function we(e){return e==="datasets"}const he={tracks:[],containerID:"GenomeBrowser",dataRoot:"data",show_tracklist:!0,show_nav:!0,show_menu:!0,show_overview:!0,show_fullviewlink:!0,update_browser_title:!0,updateBrowserURL:!0,refSeqs:"{dataRoot}/seq/refSeqs.json",include:["jbrowse.conf","jbrowse_conf.json"],nameUrl:"{dataRoot}/names/root.json",datasets:{_DEFAULT_EXAMPLES:!0,volvox:{url:"?data=sample_data/json/volvox",name:"Volvox Example"},modencode:{url:"?data=sample_data/json/modencode",name:"MODEncode Example"},yeast:{url:"?data=sample_data/json/yeast",name:"Yeast Example"}},highlightSearchedRegions:!1,highResolutionMode:"auto"};function me(e){if(e.tracks||(e.tracks=[]),!e.baseUrl)throw new Error("Must provide a `baseUrl` in configuration")}export{g as createFinalConfig,I as fetchConfigFile,Se as fetchJb1,$ as parseJb1};
//# sourceMappingURL=jb1ConfigLoad-CMs4jwpV.js.map
