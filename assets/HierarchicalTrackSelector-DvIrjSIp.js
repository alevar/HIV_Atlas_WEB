import{r as I,m as W,o as w,u as E,R as d,c3 as Ge,bc as Xe,c4 as Ye,M as pe,c5 as te,c6 as N,c7 as Ze,c8 as Me,c9 as Je,ao as L,ap as D,aq as $,p as Qe,ca as et,cb as tt,a4 as we,cc as nt,cd as q,e as Oe,T as ne,s as it,C as rt,be as Re,ce as ie,G as at,q as st,b8 as ot}from"./rpcWorker-DOy5Xw-Q.js";import{d as lt}from"./Clear-CKzlJofC.js";let x;typeof window<"u"?x=window:typeof self<"u"?x=self:x=global;let J=null,Q=null;const ve=20,K=x.clearTimeout,_e=x.setTimeout,G=x.cancelAnimationFrame||x.mozCancelAnimationFrame||x.webkitCancelAnimationFrame,Se=x.requestAnimationFrame||x.mozRequestAnimationFrame||x.webkitRequestAnimationFrame;G==null||Se==null?(J=K,Q=function(e){return _e(e,ve)}):(J=function([e,t]){G(e),K(t)},Q=function(e){const t=Se(function(){K(i),e()}),i=_e(function(){G(t),e()},ve);return[t,i]});function ct(n){let e,t,i,a,s,o,l;const h=typeof document<"u"&&document.attachEvent;if(!h){o=function(u){const m=u.__resizeTriggers__,g=m.firstElementChild,y=m.lastElementChild,b=g.firstElementChild;y.scrollLeft=y.scrollWidth,y.scrollTop=y.scrollHeight,b.style.width=g.offsetWidth+1+"px",b.style.height=g.offsetHeight+1+"px",g.scrollLeft=g.scrollWidth,g.scrollTop=g.scrollHeight},s=function(u){return u.offsetWidth!==u.__resizeLast__.width||u.offsetHeight!==u.__resizeLast__.height},l=function(u){if(u.target.className&&typeof u.target.className.indexOf=="function"&&u.target.className.indexOf("contract-trigger")<0&&u.target.className.indexOf("expand-trigger")<0)return;const m=this;o(this),this.__resizeRAF__&&J(this.__resizeRAF__),this.__resizeRAF__=Q(function(){s(m)&&(m.__resizeLast__.width=m.offsetWidth,m.__resizeLast__.height=m.offsetHeight,m.__resizeListeners__.forEach(function(b){b.call(m,u)}))})};let c=!1,v="";i="animationstart";const T="Webkit Moz O ms".split(" ");let r="webkitAnimationStart animationstart oAnimationStart MSAnimationStart".split(" "),f="";{const u=document.createElement("fakeelement");if(u.style.animationName!==void 0&&(c=!0),c===!1){for(let m=0;m<T.length;m++)if(u.style[T[m]+"AnimationName"]!==void 0){f=T[m],v="-"+f.toLowerCase()+"-",i=r[m],c=!0;break}}}t="resizeanim",e="@"+v+"keyframes "+t+" { from { opacity: 0; } to { opacity: 0; } } ",a=v+"animation: 1ms "+t+"; "}const p=function(c){if(!c.getElementById("detectElementResize")){const v=(e||"")+".resize-triggers { "+(a||"")+'visibility: hidden; opacity: 0; } .resize-triggers, .resize-triggers > div, .contract-trigger:before { content: " "; display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; z-index: -1; } .resize-triggers > div { background: #eee; overflow: auto; } .contract-trigger:before { width: 200%; height: 200%; }',T=c.head||c.getElementsByTagName("head")[0],r=c.createElement("style");r.id="detectElementResize",r.type="text/css",n!=null&&r.setAttribute("nonce",n),r.styleSheet?r.styleSheet.cssText=v:r.appendChild(c.createTextNode(v)),T.appendChild(r)}};return{addResizeListener:function(c,v){if(h)c.attachEvent("onresize",v);else{if(!c.__resizeTriggers__){const T=c.ownerDocument,r=x.getComputedStyle(c);r&&r.position==="static"&&(c.style.position="relative"),p(T),c.__resizeLast__={},c.__resizeListeners__=[],(c.__resizeTriggers__=T.createElement("div")).className="resize-triggers";const f=T.createElement("div");f.className="expand-trigger",f.appendChild(T.createElement("div"));const u=T.createElement("div");u.className="contract-trigger",c.__resizeTriggers__.appendChild(f),c.__resizeTriggers__.appendChild(u),c.appendChild(c.__resizeTriggers__),o(c),c.addEventListener("scroll",l,!0),i&&(c.__resizeTriggers__.__animationListener__=function(g){g.animationName===t&&o(c)},c.__resizeTriggers__.addEventListener(i,c.__resizeTriggers__.__animationListener__))}c.__resizeListeners__.push(v)}},removeResizeListener:function(c,v){if(h)c.detachEvent("onresize",v);else if(c.__resizeListeners__.splice(c.__resizeListeners__.indexOf(v),1),!c.__resizeListeners__.length){c.removeEventListener("scroll",l,!0),c.__resizeTriggers__.__animationListener__&&(c.__resizeTriggers__.removeEventListener(i,c.__resizeTriggers__.__animationListener__),c.__resizeTriggers__.__animationListener__=null);try{c.__resizeTriggers__=!c.removeChild(c.__resizeTriggers__)}catch{}}}}}class dt extends I.Component{constructor(...e){super(...e),this.state={height:this.props.defaultHeight||0,scaledHeight:this.props.defaultHeight||0,scaledWidth:this.props.defaultWidth||0,width:this.props.defaultWidth||0},this._autoSizer=null,this._detectElementResize=null,this._parentNode=null,this._resizeObserver=null,this._timeoutId=null,this._onResize=()=>{this._timeoutId=null;const{disableHeight:t,disableWidth:i,onResize:a}=this.props;if(this._parentNode){const s=window.getComputedStyle(this._parentNode)||{},o=parseFloat(s.paddingLeft||"0"),l=parseFloat(s.paddingRight||"0"),h=parseFloat(s.paddingTop||"0"),p=parseFloat(s.paddingBottom||"0"),_=this._parentNode.getBoundingClientRect(),S=_.height-h-p,c=_.width-o-l,v=this._parentNode.offsetHeight-h-p,T=this._parentNode.offsetWidth-o-l;(!t&&(this.state.height!==v||this.state.scaledHeight!==S)||!i&&(this.state.width!==T||this.state.scaledWidth!==c))&&(this.setState({height:v,width:T,scaledHeight:S,scaledWidth:c}),typeof a=="function"&&a({height:v,scaledHeight:S,scaledWidth:c,width:T}))}},this._setRef=t=>{this._autoSizer=t}}componentDidMount(){const{nonce:e}=this.props,t=this._autoSizer?this._autoSizer.parentNode:null;if(t!=null&&t.ownerDocument&&t.ownerDocument.defaultView&&t instanceof t.ownerDocument.defaultView.HTMLElement){this._parentNode=t;const i=t.ownerDocument.defaultView.ResizeObserver;i!=null?(this._resizeObserver=new i(()=>{this._timeoutId=setTimeout(this._onResize,0)}),this._resizeObserver.observe(t)):(this._detectElementResize=ct(e),this._detectElementResize.addResizeListener(t,this._onResize)),this._onResize()}}componentWillUnmount(){this._parentNode&&(this._detectElementResize&&this._detectElementResize.removeResizeListener(this._parentNode,this._onResize),this._timeoutId!==null&&clearTimeout(this._timeoutId),this._resizeObserver&&this._resizeObserver.disconnect())}render(){const{children:e,defaultHeight:t,defaultWidth:i,disableHeight:a=!1,disableWidth:s=!1,doNotBailOutOnEmptyChildren:o=!1,nonce:l,onResize:h,style:p={},tagName:_="div",...S}=this.props,{height:c,scaledHeight:v,scaledWidth:T,width:r}=this.state,f={overflow:"visible"},u={};let m=!1;return a||(c===0&&(m=!0),f.height=0,u.height=c,u.scaledHeight=v),s||(r===0&&(m=!0),f.width=0,u.width=r,u.scaledWidth=T),o&&(m=!1),I.createElement(_,{ref:this._setRef,style:{...f,...p},...S},!m&&e(u))}}const ut=W()(n=>({fab:{position:"absolute",bottom:n.spacing(6),right:n.spacing(6)}})),ft=w(function({model:n}){const{classes:e}=ut(),t=E.getSession(n),[i,a]=I.useState(null);function s(){a(null)}const o=E.isSessionModelWithConnections(t),l=E.isSessionWithAddTracks(t);return l||o?d.createElement(d.Fragment,null,d.createElement(Ge,{color:"secondary",className:e.fab,onClick:h=>{a(h.currentTarget)}},d.createElement(Xe,null)),d.createElement(Ye,{anchorEl:i,open:!!i,onClose:()=>{a(null)}},o?d.createElement(pe,{onClick:()=>{s(),E.isSessionModelWithWidgets(t)&&t.showWidget(t.addWidget("AddConnectionWidget","addConnectionWidget"))}},"Add connection"):null,l?d.createElement(pe,{onClick:()=>{s(),E.isSessionModelWithWidgets(t)&&t.showWidget(t.addWidget("AddTrackWidget","addTrackWidget",{view:n.view.id}))}},"Add track"):null)):null});var be=Number.isNaN||function(e){return typeof e=="number"&&e!==e};function ht(n,e){return!!(n===e||be(n)&&be(e))}function mt(n,e){if(n.length!==e.length)return!1;for(var t=0;t<n.length;t++)if(!ht(n[t],e[t]))return!1;return!0}function X(n,e){e===void 0&&(e=mt);var t,i=[],a,s=!1;function o(){for(var l=[],h=0;h<arguments.length;h++)l[h]=arguments[h];return s&&t===this&&e(l,i)||(a=n.apply(this,l),s=!0,t=this,i=l),a}return o}var gt=typeof performance=="object"&&typeof performance.now=="function",ye=gt?function(){return performance.now()}:function(){return Date.now()};function Te(n){cancelAnimationFrame(n.id)}function pt(n,e){var t=ye();function i(){ye()-t>=e?n.call(null):a.id=requestAnimationFrame(i)}var a={id:requestAnimationFrame(i)};return a}var Y=-1;function Ce(n){if(n===void 0&&(n=!1),Y===-1||n){var e=document.createElement("div"),t=e.style;t.width="50px",t.height="50px",t.overflow="scroll",document.body.appendChild(e),Y=e.offsetWidth-e.clientWidth,document.body.removeChild(e)}return Y}var H=null;function Ie(n){if(n===void 0&&(n=!1),H===null||n){var e=document.createElement("div"),t=e.style;t.width="50px",t.height="50px",t.overflow="scroll",t.direction="rtl";var i=document.createElement("div"),a=i.style;return a.width="100px",a.height="100px",e.appendChild(i),document.body.appendChild(e),e.scrollLeft>0?H="positive-descending":(e.scrollLeft=1,e.scrollLeft===0?H="negative":H="positive-ascending"),document.body.removeChild(e),H}return H}var vt=150,_t=function(e,t){return e};function St(n){var e,t=n.getItemOffset,i=n.getEstimatedTotalSize,a=n.getItemSize,s=n.getOffsetForIndexAndAlignment,o=n.getStartIndexForOffset,l=n.getStopIndexForStartIndex,h=n.initInstanceProps,p=n.shouldResetStyleCacheOnItemSizeChange,_=n.validateProps;return e=function(S){te(c,S);function c(T){var r;return r=S.call(this,T)||this,r._instanceProps=h(r.props,N(r)),r._outerRef=void 0,r._resetIsScrollingTimeoutId=null,r.state={instance:N(r),isScrolling:!1,scrollDirection:"forward",scrollOffset:typeof r.props.initialScrollOffset=="number"?r.props.initialScrollOffset:0,scrollUpdateWasRequested:!1},r._callOnItemsRendered=void 0,r._callOnItemsRendered=X(function(f,u,m,g){return r.props.onItemsRendered({overscanStartIndex:f,overscanStopIndex:u,visibleStartIndex:m,visibleStopIndex:g})}),r._callOnScroll=void 0,r._callOnScroll=X(function(f,u,m){return r.props.onScroll({scrollDirection:f,scrollOffset:u,scrollUpdateWasRequested:m})}),r._getItemStyle=void 0,r._getItemStyle=function(f){var u=r.props,m=u.direction,g=u.itemSize,y=u.layout,b=r._getItemStyleCache(p&&g,p&&y,p&&m),C;if(b.hasOwnProperty(f))C=b[f];else{var k=t(r.props,f,r._instanceProps),M=a(r.props,f,r._instanceProps),z=m==="horizontal"||y==="horizontal",O=m==="rtl",F=z?k:0;b[f]=C={position:"absolute",left:O?void 0:F,right:O?F:void 0,top:z?0:k,height:z?"100%":M,width:z?M:"100%"}}return C},r._getItemStyleCache=void 0,r._getItemStyleCache=X(function(f,u,m){return{}}),r._onScrollHorizontal=function(f){var u=f.currentTarget,m=u.clientWidth,g=u.scrollLeft,y=u.scrollWidth;r.setState(function(b){if(b.scrollOffset===g)return null;var C=r.props.direction,k=g;if(C==="rtl")switch(Ie()){case"negative":k=-g;break;case"positive-descending":k=y-m-g;break}return k=Math.max(0,Math.min(k,y-m)),{isScrolling:!0,scrollDirection:b.scrollOffset<k?"forward":"backward",scrollOffset:k,scrollUpdateWasRequested:!1}},r._resetIsScrollingDebounced)},r._onScrollVertical=function(f){var u=f.currentTarget,m=u.clientHeight,g=u.scrollHeight,y=u.scrollTop;r.setState(function(b){if(b.scrollOffset===y)return null;var C=Math.max(0,Math.min(y,g-m));return{isScrolling:!0,scrollDirection:b.scrollOffset<C?"forward":"backward",scrollOffset:C,scrollUpdateWasRequested:!1}},r._resetIsScrollingDebounced)},r._outerRefSetter=function(f){var u=r.props.outerRef;r._outerRef=f,typeof u=="function"?u(f):u!=null&&typeof u=="object"&&u.hasOwnProperty("current")&&(u.current=f)},r._resetIsScrollingDebounced=function(){r._resetIsScrollingTimeoutId!==null&&Te(r._resetIsScrollingTimeoutId),r._resetIsScrollingTimeoutId=pt(r._resetIsScrolling,vt)},r._resetIsScrolling=function(){r._resetIsScrollingTimeoutId=null,r.setState({isScrolling:!1},function(){r._getItemStyleCache(-1,null)})},r}c.getDerivedStateFromProps=function(r,f){return bt(r,f),_(r),null};var v=c.prototype;return v.scrollTo=function(r){r=Math.max(0,r),this.setState(function(f){return f.scrollOffset===r?null:{scrollDirection:f.scrollOffset<r?"forward":"backward",scrollOffset:r,scrollUpdateWasRequested:!0}},this._resetIsScrollingDebounced)},v.scrollToItem=function(r,f){f===void 0&&(f="auto");var u=this.props,m=u.itemCount,g=u.layout,y=this.state.scrollOffset;r=Math.max(0,Math.min(r,m-1));var b=0;if(this._outerRef){var C=this._outerRef;g==="vertical"?b=C.scrollWidth>C.clientWidth?Ce():0:b=C.scrollHeight>C.clientHeight?Ce():0}this.scrollTo(s(this.props,r,f,y,this._instanceProps,b))},v.componentDidMount=function(){var r=this.props,f=r.direction,u=r.initialScrollOffset,m=r.layout;if(typeof u=="number"&&this._outerRef!=null){var g=this._outerRef;f==="horizontal"||m==="horizontal"?g.scrollLeft=u:g.scrollTop=u}this._callPropsCallbacks()},v.componentDidUpdate=function(){var r=this.props,f=r.direction,u=r.layout,m=this.state,g=m.scrollOffset,y=m.scrollUpdateWasRequested;if(y&&this._outerRef!=null){var b=this._outerRef;if(f==="horizontal"||u==="horizontal")if(f==="rtl")switch(Ie()){case"negative":b.scrollLeft=-g;break;case"positive-ascending":b.scrollLeft=g;break;default:var C=b.clientWidth,k=b.scrollWidth;b.scrollLeft=k-C-g;break}else b.scrollLeft=g;else b.scrollTop=g}this._callPropsCallbacks()},v.componentWillUnmount=function(){this._resetIsScrollingTimeoutId!==null&&Te(this._resetIsScrollingTimeoutId)},v.render=function(){var r=this.props,f=r.children,u=r.className,m=r.direction,g=r.height,y=r.innerRef,b=r.innerElementType,C=r.innerTagName,k=r.itemCount,M=r.itemData,z=r.itemKey,O=z===void 0?_t:z,F=r.layout,U=r.outerElementType,A=r.outerTagName,R=r.style,Be=r.useIsScrolling,qe=r.width,fe=this.state.isScrolling,V=m==="horizontal"||F==="horizontal",Ue=V?this._onScrollHorizontal:this._onScrollVertical,he=this._getRangeToRender(),Ve=he[0],Ke=he[1],me=[];if(k>0)for(var j=Ve;j<=Ke;j++)me.push(I.createElement(f,{data:M,key:O(j,M),index:j,isScrolling:Be?fe:void 0,style:this._getItemStyle(j)}));var ge=i(this.props,this._instanceProps);return I.createElement(U||A||"div",{className:u,onScroll:Ue,ref:this._outerRefSetter,style:Ze({position:"relative",height:g,width:qe,overflow:"auto",WebkitOverflowScrolling:"touch",willChange:"transform",direction:m},R)},I.createElement(b||C||"div",{children:me,ref:y,style:{height:V?"100%":ge,pointerEvents:fe?"none":void 0,width:V?ge:"100%"}}))},v._callPropsCallbacks=function(){if(typeof this.props.onItemsRendered=="function"){var r=this.props.itemCount;if(r>0){var f=this._getRangeToRender(),u=f[0],m=f[1],g=f[2],y=f[3];this._callOnItemsRendered(u,m,g,y)}}if(typeof this.props.onScroll=="function"){var b=this.state,C=b.scrollDirection,k=b.scrollOffset,M=b.scrollUpdateWasRequested;this._callOnScroll(C,k,M)}},v._getRangeToRender=function(){var r=this.props,f=r.itemCount,u=r.overscanCount,m=this.state,g=m.isScrolling,y=m.scrollDirection,b=m.scrollOffset;if(f===0)return[0,0,0,0];var C=o(this.props,b,this._instanceProps),k=l(this.props,C,b,this._instanceProps),M=!g||y==="backward"?Math.max(1,u):1,z=!g||y==="forward"?Math.max(1,u):1;return[Math.max(0,C-M),Math.max(0,Math.min(f-1,k+z)),C,k]},c}(I.PureComponent),e.defaultProps={direction:"ltr",itemData:void 0,layout:"vertical",overscanCount:2,useIsScrolling:!1},e}var bt=function(e,t){e.children,e.direction,e.height,e.layout,e.innerTagName,e.outerTagName,e.width,t.instance},yt=50,P=function(e,t,i){var a=e,s=a.itemSize,o=i.itemMetadataMap,l=i.lastMeasuredIndex;if(t>l){var h=0;if(l>=0){var p=o[l];h=p.offset+p.size}for(var _=l+1;_<=t;_++){var S=s(_);o[_]={offset:h,size:S},h+=S}i.lastMeasuredIndex=t}return o[t]},Tt=function(e,t,i){var a=t.itemMetadataMap,s=t.lastMeasuredIndex,o=s>0?a[s].offset:0;return o>=i?We(e,t,s,0,i):Ct(e,t,Math.max(0,s),i)},We=function(e,t,i,a,s){for(;a<=i;){var o=a+Math.floor((i-a)/2),l=P(e,o,t).offset;if(l===s)return o;l<s?a=o+1:l>s&&(i=o-1)}return a>0?a-1:0},Ct=function(e,t,i,a){for(var s=e.itemCount,o=1;i<s&&P(e,i,t).offset<a;)i+=o,o*=2;return We(e,t,Math.min(i,s-1),Math.floor(i/2),a)},ke=function(e,t){var i=e.itemCount,a=t.itemMetadataMap,s=t.estimatedItemSize,o=t.lastMeasuredIndex,l=0;if(o>=i&&(o=i-1),o>=0){var h=a[o];l=h.offset+h.size}var p=i-o-1,_=p*s;return l+_},It=St({getItemOffset:function(e,t,i){return P(e,t,i).offset},getItemSize:function(e,t,i){return i.itemMetadataMap[t].size},getEstimatedTotalSize:ke,getOffsetForIndexAndAlignment:function(e,t,i,a,s,o){var l=e.direction,h=e.height,p=e.layout,_=e.width,S=l==="horizontal"||p==="horizontal",c=S?_:h,v=P(e,t,s),T=ke(e,s),r=Math.max(0,Math.min(T-c,v.offset)),f=Math.max(0,v.offset-c+v.size+o);switch(i==="smart"&&(a>=f-c&&a<=r+c?i="auto":i="center"),i){case"start":return r;case"end":return f;case"center":return Math.round(f+(r-f)/2);case"auto":default:return a>=f&&a<=r?a:a<f?f:r}},getStartIndexForOffset:function(e,t,i){return Tt(e,i,t)},getStopIndexForStartIndex:function(e,t,i,a){for(var s=e.direction,o=e.height,l=e.itemCount,h=e.layout,p=e.width,_=s==="horizontal"||h==="horizontal",S=_?p:o,c=P(e,t,a),v=i+S,T=c.offset+c.size,r=t;r<l-1&&T<v;)r++,T+=P(e,r,a).size;return r},initInstanceProps:function(e,t){var i=e,a=i.estimatedItemSize,s={itemMetadataMap:{},estimatedItemSize:a||yt,lastMeasuredIndex:-1};return t.resetAfterIndex=function(o,l){l===void 0&&(l=!0),s.lastMeasuredIndex=Math.min(s.lastMeasuredIndex,o-1),t._getItemStyleCache(-1),l&&t.forceUpdate()},s},shouldResetStyleCacheOnItemSizeChange:!1,validateProps:function(e){e.itemSize}});function kt(n){return function(e){n.forEach(function(t){typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var Z=function(){},Et=function(e,t){return t===void 0&&(t=null),{child:null,isShown:t?t.public.isOpen&&t.isShown:!0,parent:t,public:e,sibling:null,visited:!1}},zt=function(e,t){var i=t.getRecordData,a=i(e),s=a.data.id;return s},xt=function(e){var t=e.index,i=e.data,a=i.component,s=i.getRecordData,o=i.treeData,l=e.style,h=e.isScrolling,p=s(t);return d.createElement(a,Object.assign({isScrolling:h,style:l,treeData:o},p))},Mt=function(e,t,i){var a=e.createRecord,s=t.buildingTaskTimeout,o=t.placeholder,l=t.async,h=l===void 0?!1:l,p=t.treeWalker,_=h&&i.records!==void 0,S=i.records,c=[],v=new Map,T=s?{timeout:s}:void 0,r=new WeakMap,f=p(),u=f.next(),m=u.value,g=a(m.data,i,void 0,_?S.get(m.data.id):void 0);v.set(g.public.data.id,g),r.set(g,m);var y=g,b=!0,C=g,k=o!==void 0&&!(o===null&&!i.order),M=k?function(O){return O.timeRemaining()>0}:function(){return!0},z=function O(F){for(;y!==null;){if(!M(F)){requestIdleCallback(O,T);return}if(y.visited)y.visited=!1,y=y.sibling!==null?y.sibling:y.parent,C=y;else{var U=f.next(r.get(y)),A=U.value;if(A===void 0){b?b=!1:(y.isShown&&c.push(y.public.data.id),y.visited=y.child!==null,y=y.child!==null?y.child:y.sibling!==null?y.sibling:y.parent),C=y;continue}var R=a(A.data,i,b?void 0:y,_?S.get(A.data.id):void 0);v.set(R.public.data.id,R),r.set(R,A),!b&&C===y?C.child=R:C.sibling=R,C=R}}k&&i.setState({order:c,records:v,updateRequest:{}})};return k?requestIdleCallback(z,T):z(),o!==void 0&&h&&i.order?i:{order:c,records:v}},Ee=32768,wt=2,Ot=function(e,t){var i=e.order,a=e.records,s=t.opennessState;if(typeof s!="object")return null;for(var o in s)if(a.has(o)){var l=s[o],h=a.get(o),p=typeof l=="boolean"?{open:l}:l,_=p.open,S=p.subtreeCallback,c=S===void 0?Z:S,v=Z,T=Z;h.isShown&&(_?function(){for(var f=i.indexOf(o),u=h;u!==null;){if(u.sibling!==null){u=u.sibling;break}u=u.parent}var m=u===null?i.length-1-f:i.indexOf(u.public.data.id)-1-f,g=[[f+1,m]];v=function(b){if(b.isShown=b.parent?b.parent.public.isOpen&&b.parent.isShown:!0,b.isShown){var C=g[g.length-1];C.push(b.public.data.id),C.length===Ee+wt&&g.push([f+1+Ee*g.length,0])}},T=function(){for(var b=0;b<g.length;b++){var C;(C=i).splice.apply(C,g[b])}}}():h.public.isOpen&&function(){var f=i.indexOf(o),u=0;v=function(g){g.isShown&&(u+=1),g.isShown=g.parent?g.parent.public.isOpen&&g.parent.isShown:!0},T=function(){i.splice(f+1,u)}}());for(var r=h;r!==null;)r.visited?(r.visited=!1,r=r===h?null:r.sibling!==null?r.sibling:r.parent):(r.public.isOpen=r===h?_:r.public.isOpen,c(r.public,h.public),r!==h&&v(r),r.visited=r.child!==null,r=r.child!==null?r.child:r===h?null:r.sibling!==null?r.sibling:r.parent);T()}return{order:i,records:a,updateRequest:{}}},Rt=function(e){return function(t,i,a){return a.refresh?Mt(e,t,i):Ot(i,a)}},Ne=function(n){te(e,n),e.getDerivedStateFromProps=function(a,s){var o=a.listRef,l=o===void 0?null:o,h=a.treeWalker,p=s.computeTree,_=s.list,S=s.order,c=s.treeWalker;return Me({attachRefs:kt([_,l])},h!==c||!S?p(a,s,{refresh:!0}):null,{treeWalker:h})};function e(i,a){var s;return s=n.call(this,i,a)||this,s.getRecordData=s.getRecordData.bind(N(s)),s.state={list:I.createRef(),recomputeTree:s.recomputeTree.bind(N(s)),setState:s.setState.bind(N(s))},s}var t=e.prototype;return t.getItemData=function(){var a=this.props,s=a.children,o=a.itemData;return{component:s,getRecordData:this.getRecordData,treeData:o}},t.getRecordData=function(a){var s=this.state,o=s.order,l=s.records;return l.get(o[a]).public},t.recomputeTree=function(a){var s=this;return new Promise(function(o){s.setState(function(l){return l.computeTree(s.props,l,{opennessState:a})},o)})},t.scrollTo=function(a){var s;(s=this.state.list.current)==null||s.scrollTo(a)},t.scrollToItem=function(a,s){var o;(o=this.state.list.current)==null||o.scrollToItem(this.state.order.indexOf(a),s)},e}(I.PureComponent);Ne.defaultProps={rowComponent:xt};var Wt=Rt({createRecord:function(e,t,i,a){var s=t.recomputeTree,o=t.resetAfterId,l=Et({data:e,height:a?a.public.height:e.defaultHeight,isOpen:a?a.public.isOpen:e.isOpenByDefault,resize:function(p,_){l.public.height=p,o(l.public.data.id,_)},setOpen:function(p){var _;return s((_={},_[e.id]=p,_))}},i);return l}}),Nt=function(n){te(e,n);function e(i,a){var s;return s=n.call(this,i,a)||this,s.getItemSize=s.getItemSize.bind(N(s)),s.state=Me({},s.state,{computeTree:Wt,resetAfterId:s.resetAfterId.bind(N(s))}),s}var t=e.prototype;return t.resetAfterId=function(a,s){var o;s===void 0&&(s=!1);var l=this.state,h=l.list,p=l.order;(o=h.current)==null||o.resetAfterIndex(p.indexOf(a),s)},t.recomputeTree=function(a){var s=this;return n.prototype.recomputeTree.call(this,a).then(function(){var o;(o=s.state.list.current)==null||o.resetAfterIndex(0,!0)})},t.render=function(){var a=this.props;a.children;var s=a.placeholder,o=a.itemSize,l=a.rowComponent;a.treeWalker;var h=Je(a,["children","placeholder","itemSize","rowComponent","treeWalker"]),p=this.state,_=p.attachRefs,S=p.order;return s&&S.length===0?s:d.createElement(It,Object.assign({},h,{itemCount:S.length,itemData:this.getItemData(),itemKey:zt,itemSize:o??this.getItemSize,ref:_}),l)},t.getItemSize=function(a){return this.getRecordData(a).height},e}(Ne),re={},Lt=D;Object.defineProperty(re,"__esModule",{value:!0});var ae=re.default=void 0,Dt=Lt(L()),$t=$;ae=re.default=(0,Dt.default)((0,$t.jsx)("path",{d:"M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"}),"MoreHoriz");function ee(n){return(n==null?void 0:n.type)==="category"?n.children.map(e=>e.type==="category"?ee(e):e.conf).flat(Number.POSITIVE_INFINITY):[]}function B(n,e=new Map){n.id&&n.children.length&&e.set(n.id,n);for(const t of n.children)B(t,e);return e}function Ft(n=""){return n.endsWith("(Unsupported)")||n.endsWith("(Unknown)")}const At=W()(n=>({contrastColor:{color:n.palette.tertiary.contrastText},accordionText:{margin:"auto 0",width:"100%"}}));function Ht({isOpen:n,setOpen:e,data:t}){const{classes:i}=At(),[a,s]=I.useState(null),{menuItems:o=[],name:l,model:h,id:p,tree:_}=t;return d.createElement("div",{className:i.accordionText,onClick:()=>{a||(t.toggleCollapse(p),e(!n))}},d.createElement(Qe,{"data-testid":`htsCategory-${l}`},n?d.createElement(et,null):d.createElement(tt,null),l,d.createElement(we,{onClick:S=>{s(S.currentTarget),S.stopPropagation()},className:i.contrastColor},d.createElement(ae,null))),a?d.createElement(nt,{anchorEl:a,menuItems:[{label:"Add to selection",onClick:()=>{const S=B(_).get(p);h.addToSelection(ee(S))}},{label:"Remove from selection",onClick:()=>{const S=B(_).get(p);h.removeFromSelection(ee(S))}},{label:"Show all tracks",onClick:()=>{var S;for(const c of((S=B(_).get(p))===null||S===void 0?void 0:S.children)||[])c.type==="track"&&h.view.showTrack(c.trackId)}},{label:"Hide all tracks",onClick:()=>{var S;for(const c of((S=B(_).get(p))===null||S===void 0?void 0:S.children)||[])c.type==="track"&&h.view.hideTrack(c.trackId)}},...o],onMenuItemClick:(S,c)=>{c(),s(null)},open:!!a,onClose:()=>{s(null)}}):null)}var se={},Pt=D;Object.defineProperty(se,"__esModule",{value:!0});var Le=se.default=void 0,jt=Pt(L()),Bt=$;Le=se.default=(0,jt.default)((0,Bt.jsx)("path",{d:"m22 9.24-7.19-.62L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.63-7.03zM12 15.4l-3.76 2.27 1-4.28-3.32-2.88 4.38-.38L12 6.1l1.71 4.04 4.38.38-3.32 2.88 1 4.28z"}),"StarBorderOutlined");var oe={},qt=D;Object.defineProperty(oe,"__esModule",{value:!0});var De=oe.default=void 0,Ut=qt(L()),Vt=$;De=oe.default=(0,Ut.default)((0,Vt.jsx)("path",{d:"M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"}),"Star");const Kt=W()({cascadingStyle:{padding:0}}),$e=function({id:n,trackId:e,stopPropagation:t,model:i,setOpen:a,conf:s}){var o,l;const{classes:h}=Kt();return d.createElement(q,{className:h.cascadingStyle,stopPropagation:t,setOpen:a,"data-testid":`htsTrackEntryMenu-${n}`,menuItems:[...((l=(o=E.getSession(i)).getTrackActionMenuItems)===null||l===void 0?void 0:l.call(o,s))||[],i.isFavorite(e)?{label:"Remove from favorites",onClick:()=>{i.removeFromFavorites(e)},icon:Le}:{label:"Add to favorites",onClick:()=>{i.addToFavorites(e)},icon:De},{label:"Add to selection",onClick:()=>{i.addToSelection([s])}},...i.isSelected(s)?[{label:"Remove from selection",onClick:()=>{i.removeFromSelection([s])}}]:[]]},d.createElement(ae,null))},Gt=W()(n=>({compactCheckbox:{padding:0},checkboxLabel:{marginRight:0,"&:hover":{backgroundColor:n.palette.action.selected}},selected:{background:"#cccc"}}));function Xt({data:n}){const{classes:e}=Gt(),{checked:t,conf:i,model:a,drawerPosition:s,id:o,trackId:l,name:h,onChange:p,selected:_}=n,S=Oe.readConfObject(i,"description");return d.createElement(d.Fragment,null,d.createElement(ne,{title:S+(_?" (in selection)":""),placement:s==="left"?"right":"left"},d.createElement(it,{className:e.checkboxLabel,control:d.createElement(rt,{className:e.compactCheckbox,checked:t,onChange:()=>{p(l)},disabled:Ft(h),inputProps:{"data-testid":`htsTrackEntry-${o}`}}),label:d.createElement("div",{"data-testid":`htsTrackLabel-${o}`,style:{background:_?"#cccc":void 0}},d.createElement(Re,{html:h}))})),d.createElement($e,{model:a,trackId:l,id:o,conf:i}))}const Yt=W()(n=>({accordionBase:{display:"flex"},accordionCard:{padding:3,cursor:"pointer",display:"flex"},nestingLevelMarker:{position:"absolute",borderLeft:"1.5px solid #555"},accordionColor:{background:n.palette.tertiary.main,color:n.palette.tertiary.contrastText,width:"100%",display:"flex",paddingLeft:5}}));function Zt({data:n,isOpen:e,style:t,setOpen:i}){const{isLeaf:a,nestingLevel:s}=n,{classes:o}=Yt(),l=10,h=s*l+(a?l:0);return d.createElement("div",{style:t,className:a?void 0:o.accordionBase},new Array(s).fill(0).map((p,_)=>d.createElement("div",{key:`mark-${_}`,style:{left:_*l+4,height:t==null?void 0:t.height},className:o.nestingLevelMarker})),d.createElement("div",{className:a?void 0:o.accordionCard,style:{marginLeft:h,whiteSpace:"nowrap",width:"100%"}},d.createElement("div",{className:a?void 0:o.accordionColor},a?d.createElement(Xt,{data:n}):d.createElement(Ht,{isOpen:e,data:n,setOpen:i}))))}function ze(n,e,t,i){const a=n.type==="track",s=a?i[n.trackId]:!1;return{data:{defaultHeight:a?22:40,isLeaf:a,isOpenByDefault:!0,nestingLevel:e,selected:s,...n,...t},nestingLevel:e,node:n}}const xe=w(function({height:e,tree:t,model:i}){const{filterText:a,selection:s,view:o}=i,l=I.useRef(null),h=E.getSession(i),{drawerPosition:p}=h,_=I.useMemo(()=>Object.fromEntries(s.map(v=>[v.trackId,v])),[s]),S=I.useMemo(()=>({onChange:v=>{o.toggleTrack(v)&&i.addToRecentlyUsed(v)},toggleCollapse:v=>{i.toggleCategory(v)},tree:t,model:i,drawerPosition:p}),[o,i,p,t]),c=I.useCallback(function*(){for(const T of t.children)yield ze(T,0,S,_);for(;;){const T=yield;for(const r of T.node.children)yield ze(r,T.nestingLevel+1,S,_)}},[t,S,_]);return I.useEffect(()=>{l.current.recomputeTree({refreshNodes:!0,useDefaultHeight:!0})},[t,a]),d.createElement(d.Fragment,null,d.createElement(Nt,{ref:l,treeWalker:c,height:e},Zt))});var le={},Jt=D;Object.defineProperty(le,"__esModule",{value:!0});var Fe=le.default=void 0,Qt=Jt(L()),en=$;Fe=le.default=(0,Qt.default)((0,en.jsx)("path",{d:"M3 18h18v-2H3zm0-5h18v-2H3zm0-7v2h18V6z"}),"Menu");const tn=I.lazy(()=>import("./FacetedDialog-Duy0R1v4.js")),nn=I.lazy(()=>import("./CloseConnectionDialog-Bt_GaetS.js")),rn=I.lazy(()=>import("./DeleteConnectionDialog-BElj1dlS.js")),an=I.lazy(()=>import("./ManageConnectionsDialog-OK3rD-0r.js")),sn=I.lazy(()=>import("./ToggleConnectionsDialog-CJjtc2ra.js")),on=w(function({model:n}){const e=E.getSession(n),[t,i]=I.useState(),[a,s]=I.useState(),[o,l]=I.useState(!1),[h,p]=I.useState(!1),[_,S]=I.useState(!1);function c(v,T){var r;const f=Oe.readConfObject(v,"name"),u=(r=e.prepareToBreakConnection)===null||r===void 0?void 0:r.call(e,v);if(u){const[m,g]=u;Object.keys(g).length>0?i({connectionConf:v,safelyBreakConnection:m,dereferenceTypeCount:g,name:f}):m()}T&&s({name:f,connectionConf:v})}return d.createElement(d.Fragment,null,d.createElement(q,{menuItems:[{label:"Open faceted track selector",onClick:()=>{S(!0)}},...E.isSessionWithAddTracks(e)?[{label:"Add track...",onClick:()=>{E.isSessionModelWithWidgets(e)&&e.showWidget(e.addWidget("AddTrackWidget","addTrackWidget",{view:n.view.id}))}}]:[],{label:"Connections...",subMenu:[...E.isSessionModelWithConnections(e)?[{label:"Turn on/off connections...",onClick:()=>{l(!0)}}]:[],...E.isSessionModelWithConnectionEditing(e)?[{label:"Add connection...",onClick:()=>{E.isSessionModelWithWidgets(e)&&e.showWidget(e.addWidget("AddConnectionWidget","addConnectionWidget"))}},{label:"Delete connections...",onClick:()=>{p(!0)}}]:[]]},{label:"Sort...",type:"subMenu",subMenu:[{label:"Sort tracks by name",type:"checkbox",checked:n.activeSortTrackNames,onClick:()=>{n.setSortTrackNames(!n.activeSortTrackNames)}},{label:"Sort categories by name",type:"checkbox",checked:n.activeSortCategories,onClick:()=>{n.setSortCategories(!n.activeSortCategories)}}]},{label:"Collapse...",type:"subMenu",subMenu:[...n.hasAnySubcategories?[{label:"Collapse subcategories",onClick:()=>{n.collapseSubCategories()}}]:[],{label:"Collapse top-level categories",onClick:()=>{n.collapseTopLevelCategories()}},{label:"Expand all categories",onClick:()=>{n.expandAllCategories()}}]}]},d.createElement(Fe,null)),d.createElement(I.Suspense,{fallback:null},t?d.createElement(nn,{modalInfo:t,onClose:()=>{i(void 0)}}):null,a?d.createElement(rn,{handleClose:()=>{s(void 0)},deleteDialogDetails:a,session:e}):null,h?d.createElement(an,{handleClose:()=>{p(!1)},breakConnection:c,session:e}):null,o?d.createElement(sn,{handleClose:()=>{l(!1)},session:e,breakConnection:c}):null,_?d.createElement(tn,{handleClose:()=>{S(!1)},model:n}):null))});var ce={},ln=D;Object.defineProperty(ce,"__esModule",{value:!0});var Ae=ce.default=void 0,cn=ln(L()),dn=$;Ae=ce.default=(0,cn.default)((0,dn.jsx)("path",{d:"M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2M1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2"}),"ShoppingCart");const un=w(function({model:n}){const{selection:e}=n,{pluginManager:t}=E.getEnv(n),i=E.getSession(n),a=t.evaluateExtensionPoint("TrackSelector-multiTrackMenuItems",[],{session:i});return e.length?d.createElement(q,{menuItems:[{label:"Clear",onClick:()=>{n.clearSelection()}},...a.map(s=>({...s,..."onClick"in s?{onClick:()=>{s.onClick(n)}}:{}}))]},d.createElement(ie,{badgeContent:e.length,color:"primary"},d.createElement(Ae,null))):null});var de={},fn=D;Object.defineProperty(de,"__esModule",{value:!0});var He=de.default=void 0,hn=fn(L()),mn=$;He=de.default=(0,hn.default)((0,mn.jsx)("path",{d:"M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"}),"Grade");const Pe=w(function({model:n,tracks:e,extraMenuItems:t,children:i,onClick:a}){const{view:s}=n,[o,l]=I.useState(!1),h=E.getSession(n);return s?d.createElement(q,{closeAfterItemClick:!1,onClick:a,menuItems:[...e.map(p=>({type:"checkbox",label:d.createElement(d.Fragment,null,d.createElement(Re,{html:at.getTrackName(p,h)})," ",d.createElement($e,{id:p.trackId,trackId:p.trackId,model:n,conf:p,setOpen:l,stopPropagation:!0})),checked:s.tracks.some(_=>_.configuration===p),onClick:()=>{o||n.view.toggleTrack(p.trackId)&&n.addToRecentlyUsed(p.trackId)}})),...t]},i):null}),gn=W()({smallBadge:{height:14},margin:{marginRight:10}}),pn=w(function({model:n}){const{classes:e}=gn(),{view:t,favoriteTracks:i}=n;return t?d.createElement(Pe,{onClick:()=>{n.setFavoritesCounter(0)},tracks:i,model:n,extraMenuItems:i.length?[{type:"divider"},{label:"Clear favorites",onClick:()=>{n.clearFavorites()}}]:[{label:"No favorite tracks yet",onClick:()=>{}}]},d.createElement(ne,{title:"Favorite tracks"},d.createElement(ie,{classes:{badge:e.smallBadge},color:"secondary",anchorOrigin:{vertical:"bottom",horizontal:"right"},className:e.margin,badgeContent:n.favoritesCounter},d.createElement(He,null)))):null});var ue={},vn=D;Object.defineProperty(ue,"__esModule",{value:!0});var je=ue.default=void 0,_n=vn(L()),Sn=$;je=ue.default=(0,_n.default)((0,Sn.jsx)("path",{d:"M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9m-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8z"}),"History");const bn=W()({smallBadge:{height:14}}),yn=w(function({model:n}){const{classes:e}=bn(),{view:t,recentlyUsedCounter:i,recentlyUsedTracks:a}=n;return t?d.createElement(Pe,{onClick:()=>{n.setRecentlyUsedCounter(0)},model:n,tracks:a,extraMenuItems:a.length?[{type:"divider"},{label:"Clear recently used",onClick:()=>{n.clearRecentlyUsed()}}]:[{label:"No recently used",onClick:()=>{}}]},d.createElement(ne,{title:"Recently used tracks"},d.createElement(ie,{classes:{badge:e.smallBadge},anchorOrigin:{vertical:"bottom",horizontal:"right"},color:"secondary",badgeContent:i},d.createElement(je,null)))):null}),Tn=W()(n=>({searchBox:{margin:n.spacing(2)}})),Cn=w(function({model:n}){const{filterText:e}=n,{classes:t}=Tn();return d.createElement(st,{className:t.searchBox,label:"Filter tracks",value:e,onChange:i=>{n.setFilterText(i.target.value)},fullWidth:!0,InputProps:{endAdornment:d.createElement(ot,{position:"end"},d.createElement(we,{onClick:()=>{n.clearFilterText()}},d.createElement(lt,null)))}})}),In=w(function({model:n,setHeaderHeight:e}){return d.createElement("div",{ref:t=>{e((t==null?void 0:t.getBoundingClientRect().height)||0)},"data-testid":"hierarchical_track_selector"},d.createElement("div",{style:{display:"flex"}},d.createElement(on,{model:n}),d.createElement(un,{model:n}),d.createElement(Cn,{model:n}),d.createElement(yn,{model:n}),d.createElement(pn,{model:n})))}),kn=({tree:n,model:e,offset:t})=>typeof jest>"u"?d.createElement(dt,{disableWidth:!0},i=>d.createElement(xe,{height:(i.height||t)-t,model:e,tree:n})):d.createElement(xe,{height:9e3,model:e,tree:n}),En=({overrideDimensions:n,children:e})=>n?d.createElement("div",{style:{...n}},e):e,zn=w(function({model:n,toolbarHeight:e,overrideDimensions:t}){return d.createElement(En,{overrideDimensions:t},d.createElement(xn,{model:n,toolbarHeight:e}),d.createElement(ft,{model:n}))}),xn=w(function({model:n,toolbarHeight:e=0}){const[t,i]=I.useState(0);return d.createElement(d.Fragment,null,d.createElement(In,{model:n,setHeaderHeight:i}),d.createElement(kn,{tree:n.hierarchy,model:n,offset:e+t}))});var On=Object.freeze({__proto__:null,default:zn});export{On as H,un as S,$e as T};
//# sourceMappingURL=HierarchicalTrackSelector-DvIrjSIp.js.map
