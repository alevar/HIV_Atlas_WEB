import{c as M,i as m,u as p,d as y,_ as T,O as b}from"./rpcWorker-CJ7cIcjW.js";import{I as w}from"./main-BPWpXae6.js";import{p as D,f as F}from"./featureData-XuIg4mRh.js";class L extends M.BaseFeatureDataAdapter{constructor(){super(...arguments),this.calculatedIntervalTreeMap={}}async loadDataP(a){const{statusCallback:t=()=>{}}=a||{},o=await m.openLocation(this.getConf("gffLocation"),this.pluginManager).readFile(a),r=p.isGzip(o)?await p.updateStatus("Unzipping",t,()=>y(o)):o,l=[],c={};let i=0;const d=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;let h=0;for(;i<r.length;){const n=r.indexOf(`
`,i),f=n===-1?r.subarray(i):r.subarray(i,n),e=((d==null?void 0:d.decode(f))||f.toString()).trim();if(e)if(e.startsWith("#"))l.push(e);else{if(e.startsWith(">"))break;{const u=e.indexOf("	"),s=e.slice(0,u);c[s]||(c[s]=""),c[s]+=`${e}
`}}h++%1e4===0&&t(`Loading ${Math.floor(i/1e6).toLocaleString("en-US")}/${Math.floor(r.length/1e6).toLocaleString("en-US")} MB`),i=n+1}const g=Object.fromEntries(Object.entries(c).map(([n,f])=>[n,e=>{if(!this.calculatedIntervalTreeMap[n]){e==null||e("Parsing GFF data");const u=new w;D(f).flat().map((s,v)=>new T({data:F(s),id:`${this.id}-${n}-${v}`})).forEach(s=>u.insert([s.get("start"),s.get("end")],s)),this.calculatedIntervalTreeMap[n]=u}return this.calculatedIntervalTreeMap[n]}]));return{header:l.join(`
`),intervalTreeMap:g}}async loadData(a){return this.gffFeatures||(this.gffFeatures=this.loadDataP(a).catch(t=>{throw this.gffFeatures=void 0,t})),this.gffFeatures}async getRefNames(a={}){const{intervalTreeMap:t}=await this.loadData(a);return Object.keys(t)}async getHeader(a={}){const{header:t}=await this.loadData(a);return t}getFeatures(a,t={}){return b(async o=>{var r;try{const{start:l,end:c,refName:i}=a,{intervalTreeMap:d}=await this.loadData(t);(r=d[i])===null||r===void 0||r.call(d,t.statusCallback).search([l,c]).forEach(h=>{o.next(h)}),o.complete()}catch(l){o.error(l)}},t.signal)}freeResources(){}}export{L as default};
//# sourceMappingURL=Gff3Adapter-Bim7Nv3N.js.map
