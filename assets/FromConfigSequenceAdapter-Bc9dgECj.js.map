{"version":3,"file":"FromConfigSequenceAdapter-Bc9dgECj.js","sources":["../../node_modules/@jbrowse/plugin-config/esm/FromConfigSequenceAdapter/FromConfigSequenceAdapter.js"],"sourcesContent":["import SimpleFeature from '@jbrowse/core/util/simpleFeature';\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs';\nimport { toArray } from 'rxjs/operators';\n// locals\nimport FromConfigAdapter from '../FromConfigAdapter/FromConfigAdapter';\nimport { firstValueFrom } from 'rxjs';\nexport default class FromConfigSequenceAdapter extends FromConfigAdapter {\n    /**\n     * Fetch features for a certain region\n     * @param region - Region\n     * @returns Observable of Feature objects in the region\n     */\n    getFeatures(region) {\n        return ObservableCreate(async (observer) => {\n            const feats = await firstValueFrom(super.getFeatures(region).pipe(toArray()));\n            const feat = feats[0];\n            observer.next(new SimpleFeature({\n                ...feat.toJSON(),\n                uniqueId: `${feat.id()}:${region.start}-${region.end}`,\n                end: region.end,\n                start: region.start,\n                seq: feat\n                    .get('seq')\n                    .slice(Math.max(region.start - feat.get('start'), 0), Math.max(region.end - feat.get('start'), 0)),\n            }));\n            observer.complete();\n        });\n    }\n    /**\n     * Get refName, start, and end for all features after collapsing any overlaps\n     */\n    async getRegions() {\n        const regions = [];\n        // recall: features are stored in this object sorted by start coordinate\n        for (const [refName, features] of this.features) {\n            let currentRegion;\n            for (const feature of features) {\n                if (currentRegion &&\n                    currentRegion.end >= feature.get('start') &&\n                    currentRegion.start <= feature.get('end')) {\n                    currentRegion.end = feature.get('end');\n                }\n                else {\n                    if (currentRegion) {\n                        regions.push(currentRegion);\n                    }\n                    currentRegion = {\n                        refName,\n                        start: feature.get('start'),\n                        end: feature.get('end'),\n                    };\n                }\n            }\n            if (currentRegion) {\n                regions.push(currentRegion);\n            }\n        }\n        return regions;\n    }\n    /**\n     * called to provide a hint that data tied to a certain region\n     * will not be needed for the foreseeable future and can be purged\n     * from caches, etc\n     */\n    freeResources( /* { region } */) { }\n}\n"],"names":["FromConfigSequenceAdapter","FromConfigAdapter","region","ObservableCreate","observer","feat","firstValueFrom","toArray","SimpleFeature","regions","refName","features","currentRegion","feature"],"mappings":"4GAMe,MAAMA,UAAkCC,CAAkB,CAMrE,YAAYC,EAAQ,CAChB,OAAOC,EAAiB,MAAOC,GAAa,CAExC,MAAMC,GADQ,MAAMC,EAAe,MAAM,YAAYJ,CAAM,EAAE,KAAKK,EAAO,CAAE,CAAC,GACzD,CAAC,EACpBH,EAAS,KAAK,IAAII,EAAc,CAC5B,GAAGH,EAAK,OAAQ,EAChB,SAAU,GAAGA,EAAK,IAAI,IAAIH,EAAO,KAAK,IAAIA,EAAO,GAAG,GACpD,IAAKA,EAAO,IACZ,MAAOA,EAAO,MACd,IAAKG,EACA,IAAI,KAAK,EACT,MAAM,KAAK,IAAIH,EAAO,MAAQG,EAAK,IAAI,OAAO,EAAG,CAAC,EAAG,KAAK,IAAIH,EAAO,IAAMG,EAAK,IAAI,OAAO,EAAG,CAAC,CAAC,CACrH,CAAa,CAAC,EACFD,EAAS,SAAU,CAC/B,CAAS,CACT,CAII,MAAM,YAAa,CACf,MAAMK,EAAU,CAAE,EAElB,SAAW,CAACC,EAASC,CAAQ,IAAK,KAAK,SAAU,CAC7C,IAAIC,EACJ,UAAWC,KAAWF,EACdC,GACAA,EAAc,KAAOC,EAAQ,IAAI,OAAO,GACxCD,EAAc,OAASC,EAAQ,IAAI,KAAK,EACxCD,EAAc,IAAMC,EAAQ,IAAI,KAAK,GAGjCD,GACAH,EAAQ,KAAKG,CAAa,EAE9BA,EAAgB,CACZ,QAAAF,EACA,MAAOG,EAAQ,IAAI,OAAO,EAC1B,IAAKA,EAAQ,IAAI,KAAK,CACzB,GAGLD,GACAH,EAAQ,KAAKG,CAAa,CAE1C,CACQ,OAAOH,CACf,CAMI,eAAiC,CAAA,CACrC","x_google_ignoreList":[0]}