import{B as b,a as y}from"./bbi-DuXevKKM.js";import{I as B,Q as P,u as S,aQ as x,O as N}from"./index-CYW4W05g.js";class v extends b{async getView(t,e){const{zoomLevels:s,refsByName:i,isBigEndian:r,uncompressBufSize:u}=await this.getHeader(e),c=1/t,l=s.length-1;for(let o=l;o>=0;o-=1){const n=s[o];if(n&&n.reductionLevel<=2*c)return new y(this.bbi,i,n.indexOffset,r,u>0,"summary")}return this.getUnzoomedView(e)}}class C extends B.BaseFeatureDataAdapter{async setupPre(t){const{statusCallback:e=()=>{}}=t||{},s=this.pluginManager,i=new v({filehandle:P.openLocation(this.getConf("bigWigLocation"),s)}),r=await S.updateStatus("Downloading bigwig header",e,()=>i.getHeader(t));return{bigwig:i,header:r}}async setup(t){return this.setupP||(this.setupP=this.setupPre(t).catch(e=>{throw this.setupP=void 0,e})),this.setupP}async getRefNames(t){const{header:e}=await this.setup(t);return Object.keys(e.refsByName)}async refIdToName(t){var e;const{header:s}=await this.setup();return(e=s.refsByNumber[t])===null||e===void 0?void 0:e.name}async getGlobalStats(t){const{header:e}=await this.setup(t);return x(e.totalSummary)}getFeatures(t,e={}){const{refName:s,start:i,end:r}=t,{bpPerPx:u=0,signal:c,resolution:l=1,statusCallback:o=()=>{}}=e;return N(async n=>{o("Downloading bigwig data");const g=this.getConf("source"),h=this.getConf("resolutionMultiplier"),{bigwig:p}=await this.setup(e),m=await p.getFeatures(s,i,r,{...e,basesPerSpan:u/l*h});for(const a of m){g&&(a.source=g);const d=`${g}:${t.refName}:${a.start}-${a.end}`;a.refName=s,a.uniqueId=d,n.next({get:w=>a[w],id:()=>d,toJSON:()=>a})}n.complete()},c)}async getMultiRegionFeatureDensityStats(t){return{featureDensity:0}}freeResources(){}}C.capabilities=["hasResolution","hasLocalStats","hasGlobalStats"];export{C as default};
//# sourceMappingURL=BigWigAdapter-BYg3TKiR.js.map
