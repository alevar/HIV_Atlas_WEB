{"version":3,"file":"SupplementaryAlignments-YwRzpgYj.js","sources":["../node_modules/@jbrowse/plugin-alignments/esm/AlignmentsFeatureDetail/SupplementaryAlignmentsLocStrings.js","../node_modules/@jbrowse/plugin-alignments/esm/AlignmentsFeatureDetail/getSAFeatures.js","../node_modules/@jbrowse/plugin-alignments/esm/AlignmentsFeatureDetail/LaunchSupplementaryAlignmentBreakpointSplitViewPanel.js","../node_modules/@jbrowse/plugin-alignments/esm/AlignmentsFeatureDetail/SupplementaryAlignments.js"],"sourcesContent":["import React from 'react';\nimport { Typography, Link } from '@mui/material';\n// locals\nimport { getLengthOnRef } from '../MismatchParser';\nimport { navToLoc } from './util';\nexport default function SupplementaryAlignmentsLocStrings({ tag, model, }) {\n    return (React.createElement(\"div\", null,\n        React.createElement(Typography, null, \"List of supplementary alignment locations\"),\n        React.createElement(\"ul\", null, tag\n            .split(';')\n            .filter(SA => !!SA)\n            .map((SA, idx) => {\n            const [saRef, saStart, saStrand, saCigar] = SA.split(',');\n            const saLength = getLengthOnRef(saCigar);\n            const extra = Math.floor(saLength / 5);\n            const start = +saStart;\n            const end = +saStart + saLength;\n            const sp = start - extra;\n            const ep = end + extra;\n            const locString = `${saRef}:${Math.max(1, sp)}-${ep}`;\n            const displayStart = start.toLocaleString('en-US');\n            const displayEnd = end.toLocaleString('en-US');\n            const displayString = `${saRef}:${displayStart}-${displayEnd} (${saStrand}) [${saLength}bp]`;\n            return (\n            /* biome-ignore lint/suspicious/noArrayIndexKey: */\n            React.createElement(\"li\", { key: `${locString}-${idx}` },\n                React.createElement(Link, { href: \"#\", onClick: async (event) => {\n                        event.preventDefault();\n                        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n                        navToLoc(locString, model);\n                    } }, displayString)));\n        }))));\n}\n","import { getSession } from '@jbrowse/core/util';\n// locals\nimport { featurizeSA, getClip, getLengthSansClipping } from '../MismatchParser';\nimport { getTag } from '../util';\nexport async function getSAFeatures({ view, feature, }) {\n    const { assemblyManager } = getSession(view);\n    const cigar = feature.get('CIGAR');\n    const origStrand = feature.get('strand');\n    const SA = getTag(feature, 'SA') || '';\n    const readName = feature.get('name');\n    const clipPos = getClip(cigar, 1);\n    // get the canonical refname for the read because if the read.get('refName')\n    // is chr1 and the actual fasta refName is 1 then no tracks can be opened on\n    // the top panel of the linear read vs ref\n    const assembly = await assemblyManager.waitForAssembly(view.assemblyNames[0]);\n    if (!assembly) {\n        throw new Error('assembly not found');\n    }\n    const suppAlns = featurizeSA(SA, feature.id(), origStrand, readName, true);\n    const feat = feature.toJSON();\n    feat.clipPos = clipPos;\n    feat.strand = 1;\n    feat.mate = {\n        refName: readName,\n        start: clipPos,\n        end: clipPos + getLengthSansClipping(cigar),\n    };\n    const features = [feat, ...suppAlns];\n    features.forEach((f, idx) => {\n        f.refName = assembly.getCanonicalRefName(f.refName) || f.refName;\n        f.syntenyId = idx;\n        f.mate.syntenyId = idx;\n        f.mate.uniqueId = `${f.uniqueId}_mate`;\n    });\n    features.sort((a, b) => a.clipPos - b.clipPos);\n    return features;\n}\n","import React, { lazy, useEffect, useState } from 'react';\nimport { Typography, Link } from '@mui/material';\nimport { SimpleFeature, getSession, toLocale, } from '@jbrowse/core/util';\nimport { ErrorMessage } from '@jbrowse/core/ui';\nimport { getSAFeatures } from './getSAFeatures';\n// lazies\nconst BreakendMultiLevelOptionDialog = lazy(() => import('./BreakendMultiLevelOptionDialog'));\nconst BreakendSingleLevelOptionDialog = lazy(() => import('./BreakendSingleLevelOptionDialog'));\nexport default function LaunchBreakpointSplitViewPanel({ model, feature, viewType, }) {\n    const session = getSession(model);\n    const { view } = model;\n    const [res, setRes] = useState();\n    const [error, setError] = useState();\n    useEffect(() => {\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        ;\n        (async () => {\n            try {\n                const feats = await getSAFeatures({\n                    view,\n                    feature: new SimpleFeature(feature),\n                });\n                setRes(feats);\n            }\n            catch (e) {\n                setError(e);\n                console.error(e);\n            }\n        })();\n    }, [feature, view]);\n    const ret = [];\n    if (res) {\n        for (let i = 0; i < res.length - 1; i++) {\n            ret.push([res[i], res[i + 1]]);\n        }\n    }\n    return ret.length ? (React.createElement(\"div\", null,\n        React.createElement(Typography, null, \"Launch split view\"),\n        error ? React.createElement(ErrorMessage, { error: error }) : null,\n        React.createElement(\"ul\", null, ret.map((arg, index) => {\n            const [f1, f2] = arg;\n            return (React.createElement(\"li\", { key: `${JSON.stringify(arg)}-${index}` },\n                f1.refName,\n                \":\",\n                toLocale(f1.strand === 1 ? f1.end : f1.start),\n                \" ->\",\n                ' ',\n                f2.refName,\n                \":\",\n                toLocale(f2.strand === 1 ? f2.start : f2.end),\n                ' ',\n                React.createElement(Link, { href: \"#\", onClick: event => {\n                        event.preventDefault();\n                        session.queueDialog(handleClose => [\n                            BreakendMultiLevelOptionDialog,\n                            {\n                                handleClose,\n                                model,\n                                feature: new SimpleFeature({ ...f1, mate: f2 }),\n                                // @ts-expect-error\n                                viewType,\n                                view: model.view,\n                                assemblyName: model.view.displayedRegions[0].assemblyName,\n                            },\n                        ]);\n                    } }, \"(top/bottom)\"),\n                ' ',\n                React.createElement(Link, { href: \"#\", onClick: event => {\n                        event.preventDefault();\n                        session.queueDialog(handleClose => [\n                            BreakendSingleLevelOptionDialog,\n                            {\n                                handleClose,\n                                model,\n                                feature: new SimpleFeature({ ...f1, mate: f2 }),\n                                // @ts-expect-error\n                                viewType,\n                                view: model.view,\n                                assemblyName: model.view.displayedRegions[0].assemblyName,\n                            },\n                        ]);\n                    } }, \"(single row)\")));\n        })))) : null;\n}\n","import React from 'react';\nimport { getEnv, getSession } from '@jbrowse/core/util';\nimport BaseCard from '@jbrowse/core/BaseFeatureWidget/BaseFeatureDetail/BaseCard';\nimport SupplementaryAlignmentsLocStrings from './SupplementaryAlignmentsLocStrings';\nimport LaunchBreakpointSplitViewPanel from './LaunchSupplementaryAlignmentBreakpointSplitViewPanel';\nexport default function SupplementaryAlignments(props) {\n    const { model, tag, feature } = props;\n    const session = getSession(model);\n    const { pluginManager } = getEnv(session);\n    let viewType;\n    try {\n        viewType = pluginManager.getViewType('BreakpointSplitView');\n    }\n    catch (e) {\n        // ignore\n    }\n    return (React.createElement(BaseCard, { ...props, title: \"Supplementary alignments\" },\n        React.createElement(SupplementaryAlignmentsLocStrings, { model: model, tag: tag }),\n        viewType ? (React.createElement(LaunchBreakpointSplitViewPanel, { viewType: viewType, model: model, feature: feature })) : null));\n}\n"],"names":["SupplementaryAlignmentsLocStrings","tag","model","React","Typography","SA","idx","saRef","saStart","saStrand","saCigar","saLength","getLengthOnRef","extra","start","end","sp","ep","locString","displayStart","displayEnd","displayString","Link","event","navToLoc","getSAFeatures","view","feature","assemblyManager","getSession","cigar","origStrand","getTag","readName","clipPos","getClip","assembly","suppAlns","featurizeSA","feat","getLengthSansClipping","features","f","a","b","BreakendMultiLevelOptionDialog","lazy","BreakendSingleLevelOptionDialog","LaunchBreakpointSplitViewPanel","viewType","session","res","setRes","useState","error","setError","useEffect","feats","SimpleFeature","e","ret","i","ErrorMessage","arg","index","f1","f2","toLocale","handleClose","SupplementaryAlignments","props","pluginManager","getEnv","BaseCard"],"mappings":"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","x_google_ignoreList":[0,1,2,3]}